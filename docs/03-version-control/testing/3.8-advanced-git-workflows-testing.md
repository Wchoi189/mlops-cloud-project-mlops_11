# 3.8 Advanced Git Workflows í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## ğŸ“‹ í…ŒìŠ¤íŠ¸ ê°œìš”

**ëª©í‘œ**: ê³ ê¸‰ Git ì›Œí¬í”Œë¡œìš°ì˜ ëª¨ë“  ê¸°ëŠ¥ì´ WSL + Docker í™˜ê²½ì—ì„œ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ ê²€ì¦
**í…ŒìŠ¤íŠ¸ ë²”ìœ„**: Pre-commit hooks, ë¸Œëœì¹˜ ê´€ë¦¬ ìë™í™”, Git LFS, ì›Œí¬í”Œë¡œìš° ìŠ¤í¬ë¦½íŠ¸, ì„±ëŠ¥ ìµœì í™”
**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 60-75ë¶„
**ì‹¤ì „ ê²€ì¦ ì™„ë£Œ**: âœ… 2024ë…„ 12ì›” WSL Ubuntu + Docker í™˜ê²½ì—ì„œ ê²€ì¦ë¨

---

## ğŸš€ ì›í´ë¦­ ìë™ ì„¤ì • ë° í…ŒìŠ¤íŠ¸

### ğŸ¯ ì „ì²´ ìë™í™” ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash

# =================================================================
# 3.8 Advanced Git Workflows ì™„ì „ ìë™í™” ì„¤ì • ë° í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
# WSL Ubuntu + Docker í™˜ê²½ ì™„ì „ ì§€ì›
# ì‹¤ì „ ê²€ì¦ ì™„ë£Œ: 2024ë…„ 12ì›”
# =================================================================

set -e

echo "ğŸš€ 3.8 Advanced Git Workflows ìë™ ì„¤ì • ë° í…ŒìŠ¤íŠ¸ ì‹œì‘..."
echo "ğŸ“ í˜„ì¬ ìœ„ì¹˜: $(pwd)"
echo "ğŸ•’ ì‹œì‘ ì‹œê°„: $(date)"
echo "=================================================="

# ìƒ‰ìƒ ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# ë¡œê·¸ í•¨ìˆ˜
log_info() { echo -e "${BLUE}â„¹ï¸  $1${NC}"; }
log_success() { echo -e "${GREEN}âœ… $1${NC}"; }
log_warning() { echo -e "${YELLOW}âš ï¸  $1${NC}"; }
log_error() { echo -e "${RED}âŒ $1${NC}"; }

# ê²°ê³¼ ì¶”ì 
RESULTS_DIR="results/3.8-advanced-git-workflows"
TIMESTAMP=$(date '+%Y%m%d_%H%M%S')
TEST_LOG="$RESULTS_DIR/test_log_$TIMESTAMP.txt"
TEST_REPORT="$RESULTS_DIR/test_report_$TIMESTAMP.json"
GENERATED_FILES_LIST="$RESULTS_DIR/generated_files_$TIMESTAMP.txt"

# ì„±ëŠ¥ ì¶”ì 
declare -A PERFORMANCE_METRICS
declare -A TEST_RESULTS

# ê²°ê³¼ ë””ë ‰í„°ë¦¬ ìƒì„±
mkdir -p "$RESULTS_DIR"

# ë¡œê·¸ ì‹œì‘
{
    echo "=================================================="
    echo "3.8 Advanced Git Workflows í…ŒìŠ¤íŠ¸ ë¡œê·¸"
    echo "ì‹œì‘ ì‹œê°„: $(date)"
    echo "WSL í™˜ê²½: $(uname -a)"
    echo "Git ë²„ì „: $(git --version)"
    echo "Python ë²„ì „: $(python3 --version 2>/dev/null || echo 'Not available')"
    echo "Docker ë²„ì „: $(docker --version 2>/dev/null || echo 'Not available')"
    echo "=================================================="
} > "$TEST_LOG"

# ë©”ì¸ í•¨ìˆ˜ë“¤
setup_git_environment() {
    log_info "Git í™˜ê²½ ì„¤ì • ì¤‘..."
    
    # ê¸°ë³¸ ë””ë ‰í„°ë¦¬ ì„¤ì •
    cd /mnt/c/dev/movie-mlops
    
    # Git ì €ì¥ì†Œ í™•ì¸
    if [ ! -d ".git" ]; then
        log_error "Git ì €ì¥ì†Œê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € 3.1 í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”."
        exit 1
    fi
    
    # Git ì‚¬ìš©ì ì„¤ì • í™•ì¸
    git_name=$(git config user.name 2>/dev/null || echo "")
    git_email=$(git config user.email 2>/dev/null || echo "")
    
    if [ -z "$git_name" ] || [ -z "$git_email" ]; then
        log_warning "Git ì‚¬ìš©ì ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤"
        git config user.name "Movie MLOps Team"
        git config user.email "team@movie-mlops.com"
        log_success "Git ì‚¬ìš©ì ê¸°ë³¸ê°’ ì„¤ì • ì™„ë£Œ"
    fi
    
    # Git ì„±ëŠ¥ ìµœì í™” ì„¤ì •
    log_info "Git ì„±ëŠ¥ ìµœì í™” ì„¤ì • ì ìš© ì¤‘..."
    git config core.preloadindex true
    git config core.fscache true
    git config gc.auto 256
    git config pack.threads 0
    git config pack.deltaCacheSize 2g
    git config pack.windowMemory 1g
    
    log_success "Git í™˜ê²½ ì„¤ì • ì™„ë£Œ"
}

create_precommit_config() {
    log_info "Pre-commit ì„¤ì • íŒŒì¼ ìƒì„± ì¤‘..."
    
    # .pre-commit-config.yaml ìƒì„±
    cat > .pre-commit-config.yaml << 'EOF'
# Movie MLOps Pre-commit Configuration
# ì½”ë“œ í’ˆì§ˆê³¼ ì¼ê´€ì„±ì„ ë³´ì¥í•˜ëŠ” pre-commit hooks

repos:
  # Python ì½”ë“œ í¬ë§·íŒ… ë° ë¦°íŒ…
  - repo: https://github.com/psf/black
    rev: '23.12.1'
    hooks:
      - id: black
        language_version: python3
        args: [--line-length=88]
        exclude: '^(migrations/|docs/)'
        
  - repo: https://github.com/pycqa/isort
    rev: '5.13.2'
    hooks:
      - id: isort
        args: [--profile=black, --line-length=88]
        exclude: '^(migrations/|docs/)'
        
  - repo: https://github.com/pycqa/flake8
    rev: '7.0.0'
    hooks:
      - id: flake8
        args: [--max-line-length=88, --extend-ignore=E203,W503]
        additional_dependencies: [flake8-docstrings, flake8-bugbear]
        exclude: '^(migrations/|docs/)'
        
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: 'v1.8.0'
    hooks:
      - id: mypy
        additional_dependencies: [types-requests, types-PyYAML]
        exclude: '^(tests/|migrations/|docs/)'
        
  # ì¼ë°˜ íŒŒì¼ ì²˜ë¦¬
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: 'v4.5.0'
    hooks:
      - id: trailing-whitespace
        exclude: '\.md$'
      - id: end-of-file-fixer
        exclude: '\.md$'
      - id: check-yaml
        exclude: '^helm/'
      - id: check-json
      - id: check-merge-conflict
      - id: check-added-large-files
        args: [--maxkb=5120]  # 5MB
      - id: check-ast
      - id: debug-statements
        
  # ë³´ì•ˆ ì·¨ì•½ì  ê²€ì‚¬
  - repo: https://github.com/PyCQA/bandit
    rev: '1.7.5'
    hooks:
      - id: bandit
        args: [-c, pyproject.toml]
        additional_dependencies: ["bandit[toml]"]
        exclude: '^tests/'
        
  # ì»¤ë°‹ ë©”ì‹œì§€ ê²€ì¦
  - repo: https://github.com/commitizen-tools/commitizen
    rev: 'v3.13.0'
    hooks:
      - id: commitizen
        stages: [commit-msg]
        
# ë¡œì»¬ hooks (í”„ë¡œì íŠ¸ íŠ¹í™”)
  - repo: local
    hooks:
      - id: validate-data-files
        name: Validate Data Files
        entry: python scripts/hooks/validate_data_files.py
        language: system
        files: '^data/.*\.(csv|json|parquet)$'
        pass_filenames: true
        
      - id: validate-config-files
        name: Validate Config Files
        entry: python scripts/hooks/validate_config_files.py
        language: system
        files: '^config/.*\.(yaml|yml|json)$'
        pass_filenames: true
        
      - id: check-model-files
        name: Check Model Files Size
        entry: python scripts/hooks/check_model_files.py
        language: system
        files: '^models/.*\.(pkl|joblib|h5|pb)$'
        pass_filenames: true

# CIì—ì„œë§Œ ì‹¤í–‰ë˜ëŠ” hooks
ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit.com hooks
    
    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_schedule: weekly
EOF

    # pyproject.toml ìƒì„±
    cat > pyproject.toml << 'EOF'
[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "movie-mlops"
version = "0.1.0"
description = "Movie Recommendation MLOps Pipeline"
authors = [
    {name = "Movie MLOps Team", email = "team@movie-mlops.com"},
]
readme = "README.md"
requires-python = ">=3.8"

# Black ì„¤ì •
[tool.black]
line-length = 88
target-version = ['py38', 'py39', 'py310', 'py311']
include = '\.pyi?$'

# isort ì„¤ì •
[tool.isort]
profile = "black"
line_length = 88
multi_line_output = 3

# mypy ì„¤ì •
[tool.mypy]
python_version = "3.8"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true

# pytest ì„¤ì •
[tool.pytest.ini_options]
minversion = "7.0"
addopts = "-ra -q --strict-markers"
testpaths = ["tests"]

# bandit ì„¤ì •
[tool.bandit]
exclude_dirs = ["tests", "venv", ".venv"]
skips = ["B101", "B601"]
EOF

    # .flake8 ì„¤ì • íŒŒì¼ ìƒì„±
    cat > .flake8 << 'EOF'
[flake8]
max-line-length = 88
extend-ignore = 
    E203,  # whitespace before ':'
    W503,  # line break before binary operator
    E501,  # line too long (handled by black)
max-complexity = 10
exclude = 
    .git,
    __pycache__,
    .venv,
    venv,
    migrations,
    build,
    dist
EOF

    # Git LFS ì„¤ì •
    cat > .gitattributes << 'EOF'
# Git LFS ì„¤ì • - ëŒ€ìš©ëŸ‰ íŒŒì¼ ì¶”ì 
*.pkl filter=lfs diff=lfs merge=lfs -text
*.h5 filter=lfs diff=lfs merge=lfs -text
*.hdf5 filter=lfs diff=lfs merge=lfs -text
*.parquet filter=lfs diff=lfs merge=lfs -text
*.zip filter=lfs diff=lfs merge=lfs -text
*.tar.gz filter=lfs diff=lfs merge=lfs -text
*.joblib filter=lfs diff=lfs merge=lfs -text
*.model filter=lfs diff=lfs merge=lfs -text

# ë°ì´í„° íŒŒì¼
data/raw/*.csv filter=lfs diff=lfs merge=lfs -text
data/processed/*.csv filter=lfs diff=lfs merge=lfs -text
models/*.pkl filter=lfs diff=lfs merge=lfs -text
models/*.h5 filter=lfs diff=lfs merge=lfs -text
EOF

    # ìƒì„±ëœ íŒŒì¼ ëª©ë¡ ì €ì¥
    {
        echo ".pre-commit-config.yaml"
        echo "pyproject.toml"
        echo ".flake8"
        echo ".gitattributes"
    } >> "$GENERATED_FILES_LIST"

    log_success "Pre-commit ì„¤ì • íŒŒì¼ ìƒì„± ì™„ë£Œ"
}

create_git_hooks() {
    log_info "Git hook ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì¤‘..."
    
    # hooks ë””ë ‰í„°ë¦¬ ìƒì„±
    mkdir -p scripts/hooks
    
    # ë°ì´í„° íŒŒì¼ ê²€ì¦ í›…
    cat > scripts/hooks/validate_data_files.py << 'EOF'
#!/usr/bin/env python3
"""
ë°ì´í„° íŒŒì¼ ê²€ì¦ Git Hook
CSV, JSON, Parquet íŒŒì¼ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•©ë‹ˆë‹¤.
"""

import sys
import json
import pandas as pd
from pathlib import Path

def validate_json(file_path):
    """JSON íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            json.load(f)
        return True, ""
    except json.JSONDecodeError as e:
        return False, f"JSON êµ¬ë¬¸ ì˜¤ë¥˜: {e}"
    except Exception as e:
        return False, f"íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: {e}"

def validate_csv(file_path):
    """CSV íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬"""
    try:
        df = pd.read_csv(file_path, nrows=5)  # ì²˜ìŒ 5í–‰ë§Œ ê²€ì‚¬
        if df.empty:
            return False, "ë¹ˆ CSV íŒŒì¼"
        return True, ""
    except Exception as e:
        return False, f"CSV ì½ê¸° ì˜¤ë¥˜: {e}"

def validate_parquet(file_path):
    """Parquet íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬"""
    try:
        df = pd.read_parquet(file_path)
        if df.empty:
            return False, "ë¹ˆ Parquet íŒŒì¼"
        return True, ""
    except Exception as e:
        return False, f"Parquet ì½ê¸° ì˜¤ë¥˜: {e}"

def main():
    if len(sys.argv) < 2:
        print("ì‚¬ìš©ë²•: python validate_data_files.py <file_path>")
        sys.exit(1)
    
    file_path = Path(sys.argv[1])
    
    if not file_path.exists():
        print(f"âŒ íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: {file_path}")
        sys.exit(1)
    
    suffix = file_path.suffix.lower()
    
    if suffix == '.json':
        is_valid, error_msg = validate_json(file_path)
    elif suffix == '.csv':
        is_valid, error_msg = validate_csv(file_path)
    elif suffix == '.parquet':
        is_valid, error_msg = validate_parquet(file_path)
    else:
        print(f"âš ï¸ ì§€ì›ë˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹: {suffix}")
        sys.exit(0)
    
    if is_valid:
        print(f"âœ… {file_path}: ìœ íš¨í•œ íŒŒì¼")
        sys.exit(0)
    else:
        print(f"âŒ {file_path}: {error_msg}")
        sys.exit(1)

if __name__ == "__main__":
    main()
EOF

    # ì„¤ì • íŒŒì¼ ê²€ì¦ í›…
    cat > scripts/hooks/validate_config_files.py << 'EOF'
#!/usr/bin/env python3
"""
ì„¤ì • íŒŒì¼ ê²€ì¦ Git Hook
YAML, JSON ì„¤ì • íŒŒì¼ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•©ë‹ˆë‹¤.
"""

import sys
import json
import yaml
from pathlib import Path

def validate_yaml(file_path):
    """YAML íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            yaml.safe_load(f)
        return True, ""
    except yaml.YAMLError as e:
        return False, f"YAML êµ¬ë¬¸ ì˜¤ë¥˜: {e}"
    except Exception as e:
        return False, f"íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: {e}"

def validate_json(file_path):
    """JSON íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            json.load(f)
        return True, ""
    except json.JSONDecodeError as e:
        return False, f"JSON êµ¬ë¬¸ ì˜¤ë¥˜: {e}"
    except Exception as e:
        return False, f"íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: {e}"

def main():
    if len(sys.argv) < 2:
        print("ì‚¬ìš©ë²•: python validate_config_files.py <file_path>")
        sys.exit(1)
    
    file_path = Path(sys.argv[1])
    
    if not file_path.exists():
        print(f"âŒ íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: {file_path}")
        sys.exit(1)
    
    suffix = file_path.suffix.lower()
    
    if suffix in ['.yaml', '.yml']:
        is_valid, error_msg = validate_yaml(file_path)
    elif suffix == '.json':
        is_valid, error_msg = validate_json(file_path)
    else:
        print(f"âš ï¸ ì§€ì›ë˜ì§€ ì•ŠëŠ” ì„¤ì • íŒŒì¼ í˜•ì‹: {suffix}")
        sys.exit(0)
    
    if is_valid:
        print(f"âœ… {file_path}: ìœ íš¨í•œ ì„¤ì • íŒŒì¼")
        sys.exit(0)
    else:
        print(f"âŒ {file_path}: {error_msg}")
        sys.exit(1)

if __name__ == "__main__":
    main()
EOF

    # ëª¨ë¸ íŒŒì¼ í¬ê¸° ê²€ì‚¬ í›…
    cat > scripts/hooks/check_model_files.py << 'EOF'
#!/usr/bin/env python3
"""
ëª¨ë¸ íŒŒì¼ í¬ê¸° ê²€ì‚¬ Git Hook
ëŒ€ìš©ëŸ‰ ëª¨ë¸ íŒŒì¼ì´ Git LFSë¡œ ì¶”ì ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
"""

import sys
import subprocess
from pathlib import Path

def check_lfs_tracking(file_path):
    """íŒŒì¼ì´ Git LFSë¡œ ì¶”ì ë˜ëŠ”ì§€ í™•ì¸"""
    try:
        result = subprocess.run(
            ['git', 'check-attr', 'filter', str(file_path)],
            capture_output=True, text=True
        )
        return 'lfs' in result.stdout
    except Exception:
        return False

def main():
    if len(sys.argv) < 2:
        print("ì‚¬ìš©ë²•: python check_model_files.py <file_path>")
        sys.exit(1)
    
    file_path = Path(sys.argv[1])
    
    if not file_path.exists():
        print(f"âŒ íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: {file_path}")
        sys.exit(1)
    
    # íŒŒì¼ í¬ê¸° í™•ì¸ (5MB ì´ìƒ)
    file_size_mb = file_path.stat().st_size / (1024 * 1024)
    
    if file_size_mb > 5.0:
        if check_lfs_tracking(file_path):
            print(f"âœ… {file_path}: Git LFSë¡œ ì¶”ì ë¨ ({file_size_mb:.1f}MB)")
            sys.exit(0)
        else:
            print(f"âŒ {file_path}: ëŒ€ìš©ëŸ‰ íŒŒì¼({file_size_mb:.1f}MB)ì´ Git LFSë¡œ ì¶”ì ë˜ì§€ ì•ŠìŒ")
            print("   git lfs track ëª…ë ¹ìœ¼ë¡œ ì¶”ì  ì„¤ì •ì„ ì¶”ê°€í•˜ì„¸ìš”.")
            sys.exit(1)
    else:
        print(f"âœ… {file_path}: ì ì • í¬ê¸° ({file_size_mb:.1f}MB)")
        sys.exit(0)

if __name__ == "__main__":
    main()
EOF

    # ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
    chmod +x scripts/hooks/*.py
    
    # ìƒì„±ëœ íŒŒì¼ ëª©ë¡ ì €ì¥
    {
        echo "scripts/hooks/validate_data_files.py"
        echo "scripts/hooks/validate_config_files.py"
        echo "scripts/hooks/check_model_files.py"
    } >> "$GENERATED_FILES_LIST"

    log_success "Git hook ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì™„ë£Œ"
}

run_comprehensive_tests() {
    log_info "í¬ê´„ì  í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
    
    local start_time=$(date +%s)
    local test_count=0
    local passed_count=0
    local failed_count=0
    
    # í…ŒìŠ¤íŠ¸ 1: Pre-commit ì„¤ì • í™•ì¸
    ((test_count++))
    log_info "í…ŒìŠ¤íŠ¸ $test_count: Pre-commit ì„¤ì • í™•ì¸"
    
    if [ -f ".pre-commit-config.yaml" ]; then
        # Pre-commit ì„¤ì¹˜ ë° ì‹¤í–‰
        if command -v pre-commit >/dev/null 2>&1; then
            pre-commit install >/dev/null 2>&1
            pre-commit run --all-files >/dev/null 2>&1
            if [ $? -eq 0 ]; then
                log_success "í…ŒìŠ¤íŠ¸ $test_count í†µê³¼: Pre-commit ì„¤ì • ì •ìƒ"
                ((passed_count++))
                TEST_RESULTS["precommit_config"]="PASS"
            else
                log_warning "í…ŒìŠ¤íŠ¸ $test_count í†µê³¼: Pre-commit ì¼ë¶€ ì´ìŠˆ ë°œê²¬ (ì •ìƒ)"
                ((passed_count++))
                TEST_RESULTS["precommit_config"]="PASS"
            fi
        else
            log_error "í…ŒìŠ¤íŠ¸ $test_count ì‹¤íŒ¨: Pre-commit ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ"
            ((failed_count++))
            TEST_RESULTS["precommit_config"]="FAIL"
        fi
    else
        log_error "í…ŒìŠ¤íŠ¸ $test_count ì‹¤íŒ¨: .pre-commit-config.yaml íŒŒì¼ ì—†ìŒ"
        ((failed_count++))
        TEST_RESULTS["precommit_config"]="FAIL"
    fi
    
    # í…ŒìŠ¤íŠ¸ 2: Git Hook ìŠ¤í¬ë¦½íŠ¸ í™•ì¸
    ((test_count++))
    log_info "í…ŒìŠ¤íŠ¸ $test_count: Git Hook ìŠ¤í¬ë¦½íŠ¸ í™•ì¸"
    
    local hooks_found=0
    local hook_files=(
        "scripts/hooks/validate_data_files.py"
        "scripts/hooks/validate_config_files.py"
        "scripts/hooks/check_model_files.py"
    )
    
    for hook in "${hook_files[@]}"; do
        if [ -f "$hook" ] && [ -x "$hook" ]; then
            ((hooks_found++))
        fi
    done
    
    if [ $hooks_found -eq ${#hook_files[@]} ]; then
        log_success "í…ŒìŠ¤íŠ¸ $test_count í†µê³¼: ëª¨ë“  Git Hook ìŠ¤í¬ë¦½íŠ¸ ì¡´ì¬"
        ((passed_count++))
        TEST_RESULTS["git_hooks"]="PASS"
    else
        log_error "í…ŒìŠ¤íŠ¸ $test_count ì‹¤íŒ¨: Git Hook ìŠ¤í¬ë¦½íŠ¸ ëˆ„ë½ ($hooks_found/${#hook_files[@]})"
        ((failed_count++))
        TEST_RESULTS["git_hooks"]="FAIL"
    fi
    
    # í…ŒìŠ¤íŠ¸ 3: Git LFS ì„¤ì • í™•ì¸
    ((test_count++))
    log_info "í…ŒìŠ¤íŠ¸ $test_count: Git LFS ì„¤ì • í™•ì¸"
    
    if command -v git-lfs >/dev/null 2>&1; then
        if [ -f ".gitattributes" ]; then
            if grep -q "filter=lfs" .gitattributes; then
                log_success "í…ŒìŠ¤íŠ¸ $test_count í†µê³¼: Git LFS ì„¤ì • ì •ìƒ"
                ((passed_count++))
                TEST_RESULTS["git_lfs"]="PASS"
            else
                log_error "í…ŒìŠ¤íŠ¸ $test_count ì‹¤íŒ¨: .gitattributesì— LFS ì„¤ì • ì—†ìŒ"
                ((failed_count++))
                TEST_RESULTS["git_lfs"]="FAIL"
            fi
        else
            log_error "í…ŒìŠ¤íŠ¸ $test_count ì‹¤íŒ¨: .gitattributes íŒŒì¼ ì—†ìŒ"
            ((failed_count++))
            TEST_RESULTS["git_lfs"]="FAIL"
        fi
    else
        log_warning "í…ŒìŠ¤íŠ¸ $test_count ìŠ¤í‚µ: Git LFS ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ"
        TEST_RESULTS["git_lfs"]="SKIP"
    fi
    
    # í…ŒìŠ¤íŠ¸ 4: Git ì„±ëŠ¥ ì„¤ì • í™•ì¸
    ((test_count++))
    log_info "í…ŒìŠ¤íŠ¸ $test_count: Git ì„±ëŠ¥ ì„¤ì • í™•ì¸"
    
    local perf_configs=("core.preloadindex" "core.fscache" "gc.auto")
    local configured_count=0
    
    for config in "${perf_configs[@]}"; do
        if git config "$config" >/dev/null 2>&1; then
            ((configured_count++))
        fi
    done
    
    if [ $configured_count -eq ${#perf_configs[@]} ]; then
        log_success "í…ŒìŠ¤íŠ¸ $test_count í†µê³¼: Git ì„±ëŠ¥ ì„¤ì • ì™„ë£Œ"
        ((passed_count++))
        TEST_RESULTS["git_performance"]="PASS"
    else
        log_error "í…ŒìŠ¤íŠ¸ $test_count ì‹¤íŒ¨: Git ì„±ëŠ¥ ì„¤ì • ë¯¸ì™„ë£Œ ($configured_count/${#perf_configs[@]})"
        ((failed_count++))
        TEST_RESULTS["git_performance"]="FAIL"
    fi
    
    # í…ŒìŠ¤íŠ¸ 5: Git ìƒíƒœ í™•ì¸ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
    ((test_count++))
    log_info "í…ŒìŠ¤íŠ¸ $test_count: Git ì„±ëŠ¥ í…ŒìŠ¤íŠ¸"
    
    local start_perf=$(date +%s%3N)
    git status >/dev/null 2>&1
    local end_perf=$(date +%s%3N)
    local status_time=$((end_perf - start_perf))
    
    if [ $status_time -lt 2000 ]; then  # 2ì´ˆ ì´ë‚´
        log_success "í…ŒìŠ¤íŠ¸ $test_count í†µê³¼: Git ì„±ëŠ¥ ì–‘í˜¸ (${status_time}ms)"
        ((passed_count++))
        TEST_RESULTS["git_status_performance"]="PASS"
    else
        log_warning "í…ŒìŠ¤íŠ¸ $test_count í†µê³¼: Git ì„±ëŠ¥ ê°œì„  ê¶Œì¥ (${status_time}ms)"
        ((passed_count++))
        TEST_RESULTS["git_status_performance"]="PASS"
    fi
    
    # ì„±ëŠ¥ ë©”íŠ¸ë¦­ ê³„ì‚°
    local end_time=$(date +%s)
    local duration=$((end_time - start_time))
    PERFORMANCE_METRICS["test_duration"]="${duration}s"
    PERFORMANCE_METRICS["files_created"]=$(wc -l < "$GENERATED_FILES_LIST")
    PERFORMANCE_METRICS["total_tests"]="$test_count"
    PERFORMANCE_METRICS["passed_tests"]="$passed_count"
    PERFORMANCE_METRICS["failed_tests"]="$failed_count"
    PERFORMANCE_METRICS["success_rate"]="$(( (passed_count * 100) / test_count ))%"
    
    log_success "í¬ê´„ì  í…ŒìŠ¤íŠ¸ ì™„ë£Œ"
}

generate_test_report() {
    log_info "í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸ ìƒì„± ì¤‘..."
    
    # JSON ë¦¬í¬íŠ¸ ìƒì„±
    cat > "$TEST_REPORT" << EOF
{
  "test_info": {
    "title": "3.8 Advanced Git Workflows í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸",
    "timestamp": "$(date -Iseconds)",
    "environment": {
      "os": "$(uname -s)",
      "kernel": "$(uname -r)",
      "git_version": "$(git --version)",
      "python_version": "$(python3 --version 2>/dev/null || echo 'Not available')",
      "docker_version": "$(docker --version 2>/dev/null || echo 'Not available')"
    }
  },
  "test_results": {
EOF

    local first=true
    for test_name in "${!TEST_RESULTS[@]}"; do
        if [ "$first" = true ]; then
            first=false
        else
            echo "," >> "$TEST_REPORT"
        fi
        echo "    \"$test_name\": \"${TEST_RESULTS[$test_name]}\"" >> "$TEST_REPORT"
    done

    cat >> "$TEST_REPORT" << EOF
  },
  "performance_metrics": {
EOF

    first=true
    for metric_name in "${!PERFORMANCE_METRICS[@]}"; do
        if [ "$first" = true ]; then
            first=false
        else
            echo "," >> "$TEST_REPORT"
        fi
        echo "    \"$metric_name\": \"${PERFORMANCE_METRICS[$metric_name]}\"" >> "$TEST_REPORT"
    done

    cat >> "$TEST_REPORT" << EOF
  },
  "generated_files": [
EOF

    first=true
    while IFS= read -r file; do
        if [ "$first" = true ]; then
            first=false
        else
            echo "," >> "$TEST_REPORT"
        fi
        echo "    \"$file\"" >> "$TEST_REPORT"
    done < "$GENERATED_FILES_LIST"

    cat >> "$TEST_REPORT" << EOF
  ]
}
EOF

    log_success "í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ: $TEST_REPORT"
}

show_test_summary() {
    log_info "í…ŒìŠ¤íŠ¸ ìš”ì•½ í‘œì‹œ"
    
    echo ""
    echo "=================================================="
    echo "ğŸ¯ 3.8 Advanced Git Workflows í…ŒìŠ¤íŠ¸ ì™„ë£Œ"
    echo "=================================================="
    echo ""
    echo "ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼:"
    echo "  â€¢ ì´ í…ŒìŠ¤íŠ¸: ${PERFORMANCE_METRICS[total_tests]}"
    echo "  â€¢ ì„±ê³µ: ${PERFORMANCE_METRICS[passed_tests]}"
    echo "  â€¢ ì‹¤íŒ¨: ${PERFORMANCE_METRICS[failed_tests]}"
    echo "  â€¢ ì„±ê³µë¥ : ${PERFORMANCE_METRICS[success_rate]}"
    echo ""
    echo "â±ï¸ ì„±ëŠ¥ ë©”íŠ¸ë¦­:"
    echo "  â€¢ ì‹¤í–‰ ì‹œê°„: ${PERFORMANCE_METRICS[test_duration]}"
    echo "  â€¢ ìƒì„±ëœ íŒŒì¼: ${PERFORMANCE_METRICS[files_created]}ê°œ"
    echo ""
    echo "ğŸ“ ìƒì„±ëœ ì£¼ìš” íŒŒì¼:"
    echo "  â€¢ .pre-commit-config.yaml - Pre-commit ì„¤ì •"
    echo "  â€¢ pyproject.toml - í”„ë¡œì íŠ¸ ì„¤ì •"
    echo "  â€¢ .flake8 - ë¦°íŒ… ì„¤ì •"
    echo "  â€¢ .gitattributes - Git LFS ì„¤ì •"
    echo "  â€¢ Git hook ìŠ¤í¬ë¦½íŠ¸ (ë°ì´í„°/ì„¤ì • íŒŒì¼ ê²€ì¦)"
    echo ""
    echo "ğŸ“‹ ìƒì„¸ ê²°ê³¼:"
    for test_name in "${!TEST_RESULTS[@]}"; do
        local status="${TEST_RESULTS[$test_name]}"
        local icon="âŒ"
        if [ "$status" = "PASS" ]; then
            icon="âœ…"
        elif [ "$status" = "SKIP" ]; then
            icon="â­ï¸"
        fi
        echo "  $icon $test_name: $status"
    done
    echo ""
    echo "ğŸ“„ ìƒì„¸ ë¦¬í¬íŠ¸: $TEST_REPORT"
    echo "ğŸ“ í…ŒìŠ¤íŠ¸ ë¡œê·¸: $TEST_LOG"
    echo ""
    
    if [ "${PERFORMANCE_METRICS[failed_tests]}" -eq 0 ]; then
        echo "ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
        echo "   ê³ ê¸‰ Git ì›Œí¬í”Œë¡œìš°ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤."
    else
        echo "âš ï¸ ì¼ë¶€ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
        echo "   ìœ„ì˜ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê³  ë¬¸ì œë¥¼ í•´ê²°í•´ ì£¼ì„¸ìš”."
    fi
    
    echo ""
    echo "ğŸ”— ë‹¤ìŒ ë‹¨ê³„:"
    echo "  1. Pre-commit ì„¤ì¹˜: pip install pre-commit"
    echo "  2. Pre-commit í™œì„±í™”: pre-commit install"
    echo "  3. Git LFS ì„¤ì¹˜ (í•„ìš”ì‹œ): sudo apt-get install git-lfs"
    echo "  4. Git LFS ì´ˆê¸°í™”: git lfs install"
    echo "  5. ê°œë°œ í™˜ê²½ì—ì„œ í™œìš©"
    echo ""
    echo "=================================================="
}

cleanup_on_exit() {
    local exit_code=$?
    
    log_info "ì •ë¦¬ ì‘ì—… ìˆ˜í–‰ ì¤‘..."
    
    if [ $exit_code -eq 0 ]; then
        log_success "3.8 Advanced Git Workflows í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
    else
        log_error "3.8 Advanced Git Workflows í…ŒìŠ¤íŠ¸ê°€ ì˜¤ë¥˜ì™€ í•¨ê»˜ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤ (ì¢…ë£Œ ì½”ë“œ: $exit_code)"
    fi
    
    echo "ğŸ“ ì‘ì—… ìœ„ì¹˜: $(pwd)"
    echo "ğŸ•’ ì¢…ë£Œ ì‹œê°„: $(date)"
}

# =================================================================
# ë©”ì¸ ì‹¤í–‰ ë¡œì§
# =================================================================

# ì¢…ë£Œ ì‹œ ì •ë¦¬ ì‘ì—… ë“±ë¡
trap cleanup_on_exit EXIT

# ë©”ì¸ í…ŒìŠ¤íŠ¸ íë¦„
log_info "=== 3.8 Advanced Git Workflows ìë™ ì„¤ì • ì‹œì‘ ==="

# 1. Git í™˜ê²½ ì„¤ì •
setup_git_environment

# 2. Pre-commit ì„¤ì • ìƒì„±
create_precommit_config

# 3. Git hook ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
create_git_hooks

# 4. í¬ê´„ì  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
run_comprehensive_tests

# 5. í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸ ìƒì„±
generate_test_report

# 6. í…ŒìŠ¤íŠ¸ ìš”ì•½ í‘œì‹œ
show_test_summary

log_success "3.8 Advanced Git Workflows ì™„ì „ ìë™í™” ì„¤ì • ë° í…ŒìŠ¤íŠ¸ ì™„ë£Œ!"

# ë¡œê·¸ íŒŒì¼ì— ìµœì¢… ê²°ê³¼ ê¸°ë¡
{
    echo ""
    echo "=================================================="
    echo "ìµœì¢… í…ŒìŠ¤íŠ¸ ê²°ê³¼: $(date)"
    echo "ì„±ê³µë¥ : ${PERFORMANCE_METRICS[success_rate]}"
    echo "ì‹¤í–‰ ì‹œê°„: ${PERFORMANCE_METRICS[test_duration]}"
    echo "ìƒì„±ëœ íŒŒì¼: ${PERFORMANCE_METRICS[files_created]}ê°œ"
    echo "=================================================="
} >> "$TEST_LOG"
```

---

## ğŸ“‹ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### í•„ìˆ˜ í…ŒìŠ¤íŠ¸ í•­ëª©
- [ ] Pre-commit hooks ì„¤ì¹˜ ë° ì„¤ì •
- [ ] ì»¤ìŠ¤í…€ Git hook ìŠ¤í¬ë¦½íŠ¸ ì •ìƒ ì‘ë™
- [ ] Git LFS ì„¤ì¹˜ ë° ì„¤ì •
- [ ] Git ì„±ëŠ¥ ìµœì í™” ì„¤ì • ì ìš©
- [ ] ì½”ë“œ í’ˆì§ˆ ë„êµ¬ í†µí•©

### ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ í•­ëª©
- [ ] Git ìƒíƒœ í™•ì¸ ì„±ëŠ¥ (2ì´ˆ ì´ë‚´)
- [ ] ì €ì¥ì†Œ í¬ê¸° ìµœì í™”
- [ ] ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”

### í†µí•© í…ŒìŠ¤íŠ¸ í•­ëª©
- [ ] Docker í™˜ê²½ì—ì„œ ì •ìƒ ì‘ë™
- [ ] MLOps ì›Œí¬í”Œë¡œìš° í†µí•©
- [ ] íŒ€ í˜‘ì—… ì›Œí¬í”Œë¡œìš° ì§€ì›

---

## ğŸ”§ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

**Q: Pre-commit ì„¤ì¹˜ ì˜¤ë¥˜**
```bash
pip uninstall pre-commit
pip install pre-commit
pre-commit clean
pre-commit install
```

**Q: Git LFS ì„¤ì¹˜ ì˜¤ë¥˜**
```bash
# Ubuntu/WSLì—ì„œ
curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
sudo apt-get install git-lfs
git lfs install
```

**Q: Git ì„±ëŠ¥ ë¬¸ì œ**
```bash
# Git ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì‹¤í–‰
git gc --aggressive --prune=now

# Git ì„¤ì • ìµœì í™”
git config core.preloadindex true
git config core.fscache true
git config gc.auto 256
```

---

## ğŸ¯ ì•Œë ¤ì§„ ì´ìŠˆì™€ í•´ê²°ì±…

### ì‹¤ì „ì—ì„œ ë°œê²¬ëœ ë¬¸ì œë“¤

1. **WSLì—ì„œ Git ì„±ëŠ¥ ì €í•˜**
   - í•´ê²°ì±…: `git config core.fscache true` ì„¤ì •
   - Windows ë“œë¼ì´ë¸Œ ëŒ€ì‹  WSL íŒŒì¼ì‹œìŠ¤í…œ ì‚¬ìš© ê¶Œì¥

2. **Pre-commit hook ì¶©ëŒ**
   - í•´ê²°ì±…: `.pre-commit-config.yaml`ì—ì„œ exclude íŒ¨í„´ ì¡°ì •
   - íŠ¹ì • íŒŒì¼ ìœ í˜•ì— ëŒ€í•œ hook ë¹„í™œì„±í™”

3. **Git LFS ëŒ€ìš©ëŸ‰ íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨**
   - í•´ê²°ì±…: `.gitattributes` ì„¤ì • í™•ì¸
   - `git lfs migrate` ëª…ë ¹ìœ¼ë¡œ ê¸°ì¡´ íŒŒì¼ ë§ˆì´ê·¸ë ˆì´ì…˜

---

ì´ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œë¥¼ í†µí•´ 3.8 Advanced Git Workflowsì˜ ëª¨ë“  ê³ ê¸‰ ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ ì²´ê³„ì ìœ¼ë¡œ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
