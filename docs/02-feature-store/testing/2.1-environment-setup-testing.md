# 2.1 í™˜ê²½ ì„¤ì • ë° ê¸°ë³¸ í…ŒìŠ¤íŠ¸

## ğŸ“‹ ê°œìš”

Docker í™˜ê²½ì—ì„œ í”¼ì²˜ ìŠ¤í† ì–´ ì‹œìŠ¤í…œì˜ ê¸°ë³¸ í™˜ê²½ì„ ì„¤ì •í•˜ê³  ê²€ì¦í•˜ëŠ” ê°€ì´ë“œì…ë‹ˆë‹¤.

## âš ï¸ ì‚¬ì „ ì¤€ë¹„ í•„ìˆ˜

**ì´ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— ë°˜ë“œì‹œ [2.0-prerequisite-setup.md](./2.0-prerequisite-setup.md)ë¥¼ ì™„ë£Œí•˜ì„¸ìš”!**

ë˜ëŠ” ìë™í™” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”:
```bash
# WSL/Linuxì—ì„œ
./quick-setup-wsl.sh
```

### ì‚¬ì „ ì¤€ë¹„ í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Docker Desktop ì‹¤í–‰ ì¤‘
- [ ] Docker ì´ë¯¸ì§€ ë¹Œë“œ ì™„ë£Œ (`movie-mlops-dev` ì´ë¯¸ì§€ ì¡´ì¬)
- [ ] ê¸°ë³¸ ì„œë¹„ìŠ¤ 3ê°œ ì‹¤í–‰ ì¤‘ (dev, postgres, redis)
- [ ] ê¸°ë³¸ í—¬ìŠ¤ì²´í¬ í†µê³¼
- [ ] í•„ìˆ˜ ë””ë ‰í† ë¦¬ ë° íŒŒì¼ ì¡´ì¬

---

## ğŸš€ 1. Docker í™˜ê²½ ì‹œì‘

### 1.1 ê¸°ë³¸ ì„œë¹„ìŠ¤ ì‹œì‘

```bash
# ê¸°ë³¸ ê°œë°œ í™˜ê²½ ì‹œì‘
docker compose up -d dev redis postgres

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker compose ps

# ì˜ˆìƒ ì¶œë ¥:
#     Name                    Command               State           Ports
# ---------------------------------------------------------------------------
# movie-mlops-dev-1      sleep infinity               Up      
# movie-mlops-postgres-1 docker-entrypoint.sh postgres   Up      5432/tcp
# movie-mlops-redis-1    docker-entrypoint.sh redis... Up      6379/tcp
```

### 1.2 ì „ì²´ í™˜ê²½ ì‹œì‘ (API í¬í•¨)

```bash
# API ì„œë²„ í¬í•¨ ì‹œì‘
docker compose --profile api up -d

# ëª¨ë‹ˆí„°ë§ í¬í•¨ ì „ì²´ ì‹œì‘
docker compose --profile api --profile monitoring up -d
```

---

## ğŸ” 2. í™˜ê²½ ìƒíƒœ ê²€ì¦

### 2.1 ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸

```bash
# ëª¨ë“  í•µì‹¬ ì„œë¹„ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import redis, psycopg2

print('ğŸ” ê¸°ë³¸ í™˜ê²½ ê²€ì¦ ì‹œì‘...')

# Redis ì—°ê²° í…ŒìŠ¤íŠ¸
try:
    r = redis.Redis(host='redis', port=6379, decode_responses=True)
    r.ping()
    print('âœ… Redis: ì—°ê²° ì„±ê³µ (PONG ì‘ë‹µ)')
except Exception as e:
    print(f'âŒ Redis ì—°ê²° ì‹¤íŒ¨: {e}')

# PostgreSQL ì—°ê²° í…ŒìŠ¤íŠ¸
try:
    conn = psycopg2.connect(
        host='postgres', 
        database='mlops', 
        user='mlops_user', 
        password='mlops_password'
    )
    cursor = conn.cursor()
    cursor.execute('SELECT version();')
    version = cursor.fetchone()[0]
    cursor.close()
    conn.close()
    print(f'âœ… PostgreSQL: ì—°ê²° ì„±ê³µ')
    print(f'   ë²„ì „: {version[:30]}...')
except Exception as e:
    print(f'âŒ PostgreSQL ì—°ê²° ì‹¤íŒ¨: {e}')

print('âœ… ê¸°ë³¸ í™˜ê²½ ê²€ì¦ ì™„ë£Œ')
"
```

### 2.2 í¬íŠ¸ ë° ë„¤íŠ¸ì›Œí¬ í™•ì¸

```bash
# í¬íŠ¸ ì‚¬ìš© í˜„í™© í™•ì¸
echo "ğŸŒ í¬íŠ¸ í™•ì¸..."
docker compose exec dev netstat -tuln | grep -E ":(5432|6379|8001|8002|9090|3000)"

# ì»¨í…Œì´ë„ˆ ê°„ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸
echo "ğŸ”— ë„¤íŠ¸ì›Œí¬ ì—°ê²° í…ŒìŠ¤íŠ¸..."
docker compose exec dev ping -c 3 redis
docker compose exec dev ping -c 3 postgres
```

### 2.3 ë³¼ë¥¨ ë° ë°ì´í„° ë””ë ‰í† ë¦¬ í™•ì¸

```bash
# ë°ì´í„° ë””ë ‰í† ë¦¬ ê¶Œí•œ í™•ì¸
docker compose exec dev ls -la /app/data/

# ë¡œê·¸ ë””ë ‰í† ë¦¬ í™•ì¸
docker compose exec dev ls -la /app/logs/

# ì„¤ì • íŒŒì¼ í™•ì¸
docker compose exec dev ls -la /app/config/
```

---

## ğŸ§ª 3. ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

### 3.1 Python í™˜ê²½ ë° ëª¨ë“ˆ Import í…ŒìŠ¤íŠ¸

```bash
# Python í™˜ê²½ ë° ê²½ë¡œ í™•ì¸
docker compose exec dev python -c "
import sys
print('ğŸ Python í™˜ê²½ ì •ë³´:')
print(f'   Python ë²„ì „: {sys.version}')
print(f'   Python ê²½ë¡œ: {sys.executable}')
print(f'   ì‘ì—… ë””ë ‰í† ë¦¬: {sys.path[0]}')

# PYTHONPATH í™•ì¸
import os
python_path = os.environ.get('PYTHONPATH', 'Not set')
print(f'   PYTHONPATH: {python_path}')
"

# í•µì‹¬ ëª¨ë“ˆ Import í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
print('ğŸ“¦ í•µì‹¬ ëª¨ë“ˆ Import í…ŒìŠ¤íŠ¸...')

try:
    import sys
    sys.path.append('/app/src')
    
    # í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§ ëª¨ë“ˆ
    from features.engineering.tmdb_processor import AdvancedTMDBPreProcessor
    print('âœ… AdvancedTMDBPreProcessor: Import ì„±ê³µ')
    
    # í”¼ì²˜ ìŠ¤í† ì–´ ëª¨ë“ˆ
    from features.store.feature_store import SimpleFeatureStore, FeatureStoreConfig
    print('âœ… SimpleFeatureStore: Import ì„±ê³µ')
    
    # íŒŒì´í”„ë¼ì¸ ëª¨ë“ˆ
    from features.pipeline.feature_pipeline import FeaturePipeline, PipelineConfig
    print('âœ… FeaturePipeline: Import ì„±ê³µ')
    
    # ê²€ì¦ ëª¨ë“ˆ
    from features.validation.feature_validator import FeatureQualityChecker
    print('âœ… FeatureQualityChecker: Import ì„±ê³µ')
    
    print('âœ… ëª¨ë“  í•µì‹¬ ëª¨ë“ˆ Import ì™„ë£Œ')
    
except ImportError as e:
    print(f'âŒ ëª¨ë“ˆ Import ì‹¤íŒ¨: {e}')
except Exception as e:
    print(f'âŒ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜: {e}')
"
```

### 3.2 ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë³¸ ì‘ì—… í…ŒìŠ¤íŠ¸

```bash
# PostgreSQL ê¸°ë³¸ ì‘ì—… í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import psycopg2
import json
from datetime import datetime

print('ğŸ—„ï¸ PostgreSQL ê¸°ë³¸ ì‘ì—… í…ŒìŠ¤íŠ¸...')

try:
    conn = psycopg2.connect(
        host='postgres',
        database='mlops',
        user='mlops_user',
        password='mlops_password'
    )
    cursor = conn.cursor()
    
    # í…ŒìŠ¤íŠ¸ í…Œì´ë¸” ìƒì„±
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS test_features (
            id SERIAL PRIMARY KEY,
            feature_name VARCHAR(100),
            feature_value FLOAT,
            metadata JSONB,
            created_at TIMESTAMP DEFAULT NOW()
        )
    ''')
    
    # ë°ì´í„° ì‚½ì…
    test_metadata = {'source': 'test', 'version': '1.0'}
    cursor.execute('''
        INSERT INTO test_features (feature_name, feature_value, metadata) 
        VALUES (%s, %s, %s)
    ''', ('test_feature', 0.85, json.dumps(test_metadata)))
    
    # ë°ì´í„° ì¡°íšŒ
    cursor.execute('SELECT * FROM test_features WHERE feature_name = %s', ('test_feature',))
    result = cursor.fetchone()
    
    if result:
        print(f'âœ… PostgreSQL ì½ê¸°/ì“°ê¸° í…ŒìŠ¤íŠ¸ ì„±ê³µ')
        print(f'   ID: {result[0]}, ì´ë¦„: {result[1]}, ê°’: {result[2]}')
    
    # ì •ë¦¬
    cursor.execute('DROP TABLE IF EXISTS test_features')
    conn.commit()
    cursor.close()
    conn.close()
    
    print('âœ… PostgreSQL ê¸°ë³¸ ì‘ì—… í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
    
except Exception as e:
    print(f'âŒ PostgreSQL í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}')
"

# Redis ê¸°ë³¸ ì‘ì—… í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import redis
import json
import time

print('ğŸ”„ Redis ê¸°ë³¸ ì‘ì—… í…ŒìŠ¤íŠ¸...')

try:
    r = redis.Redis(host='redis', port=6379, db=0, decode_responses=True)
    
    # ê¸°ë³¸ ì €ì¥/ì¡°íšŒ
    test_data = {'feature': 'test_value', 'score': 0.95, 'timestamp': time.time()}
    r.set('test_feature_cache', json.dumps(test_data))
    
    retrieved_data = json.loads(r.get('test_feature_cache'))
    assert retrieved_data['feature'] == 'test_value'
    print('âœ… Redis ê¸°ë³¸ ì½ê¸°/ì“°ê¸° ì„±ê³µ')
    
    # TTL í…ŒìŠ¤íŠ¸
    r.setex('test_ttl', 5, 'temporary_value')
    assert r.exists('test_ttl')
    print('âœ… Redis TTL ì„¤ì • ì„±ê³µ')
    
    # ë¦¬ìŠ¤íŠ¸ ì‘ì—…
    r.lpush('test_list', 'item1', 'item2', 'item3')
    list_length = r.llen('test_list')
    assert list_length == 3
    print('âœ… Redis ë¦¬ìŠ¤íŠ¸ ì‘ì—… ì„±ê³µ')
    
    # ì •ë¦¬
    r.delete('test_feature_cache', 'test_ttl', 'test_list')
    
    print('âœ… Redis ê¸°ë³¸ ì‘ì—… í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
    
except Exception as e:
    print(f'âŒ Redis í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}')
"
```

### 3.3 íŒŒì¼ ì‹œìŠ¤í…œ ë° ê¶Œí•œ í…ŒìŠ¤íŠ¸

```bash
# íŒŒì¼ ì‹œìŠ¤í…œ ê¸°ë³¸ ì‘ì—… í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import os
from pathlib import Path
import json

print('ğŸ“ íŒŒì¼ ì‹œìŠ¤í…œ ê¸°ë³¸ ì‘ì—… í…ŒìŠ¤íŠ¸...')

try:
    # í…ŒìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ ìƒì„±
    test_dir = Path('/app/data/test_env')
    test_dir.mkdir(parents=True, exist_ok=True)
    print('âœ… ë””ë ‰í† ë¦¬ ìƒì„± ì„±ê³µ')
    
    # íŒŒì¼ ì“°ê¸° í…ŒìŠ¤íŠ¸
    test_file = test_dir / 'test_file.json'
    test_data = {'test': 'data', 'timestamp': '2024-01-01'}
    
    with open(test_file, 'w') as f:
        json.dump(test_data, f)
    print('âœ… íŒŒì¼ ì“°ê¸° ì„±ê³µ')
    
    # íŒŒì¼ ì½ê¸° í…ŒìŠ¤íŠ¸
    with open(test_file, 'r') as f:
        loaded_data = json.load(f)
    
    assert loaded_data['test'] == 'data'
    print('âœ… íŒŒì¼ ì½ê¸° ì„±ê³µ')
    
    # ê¶Œí•œ í™•ì¸
    file_stat = test_file.stat()
    print(f'âœ… íŒŒì¼ ê¶Œí•œ í™•ì¸: {oct(file_stat.st_mode)[-3:]}')
    
    # ì •ë¦¬
    test_file.unlink()
    test_dir.rmdir()
    print('âœ… ì •ë¦¬ ì™„ë£Œ')
    
    print('âœ… íŒŒì¼ ì‹œìŠ¤í…œ ê¸°ë³¸ ì‘ì—… í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
    
except Exception as e:
    print(f'âŒ íŒŒì¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}')
"
```

---

## ğŸŒ 4. API ì„œë²„ ê¸°ë³¸ ê²€ì¦ (ì„ íƒì‚¬í•­)

### 4.1 API ì„œë²„ ì‹œì‘ í™•ì¸

```bash
# API ì„œë²„ê°€ ì‹œì‘ëœ ê²½ìš°ì—ë§Œ ì‹¤í–‰
if docker compose ps | grep -q "feature-store-api"; then
    echo "ğŸŒ API ì„œë²„ ê¸°ë³¸ ê²€ì¦..."
    
    # Health Check
    curl -s http://localhost:8002/health | jq . || echo "jq ì—†ìŒ - raw ì¶œë ¥:"
    curl -s http://localhost:8002/health
    
    # API ë¬¸ì„œ ì ‘ê·¼ í™•ì¸
    if curl -s http://localhost:8002/docs | grep -q "Swagger"; then
        echo "âœ… Swagger ë¬¸ì„œ ì ‘ê·¼ ê°€ëŠ¥"
    else
        echo "âš ï¸ Swagger ë¬¸ì„œ ì ‘ê·¼ ë¶ˆê°€"
    fi
else
    echo "âš ï¸ API ì„œë²„ê°€ ì‹œì‘ë˜ì§€ ì•ŠìŒ (ì •ìƒ - ê¸°ë³¸ í”„ë¡œíŒŒì¼)"
fi
```

---

## ğŸ“Š 5. í™˜ê²½ ê²€ì¦ ìš”ì•½

### 5.1 ìë™ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸

```bash
# ì „ì²´ í™˜ê²½ ìë™ ê²€ì¦
docker compose exec dev python -c "
print('ğŸ¯ í™˜ê²½ ê²€ì¦ ìš”ì•½ ì‹œì‘...')
print('=' * 50)

# ê²€ì¦ í•­ëª© ì´ˆê¸°í™”
checks = {
    'Python í™˜ê²½': False,
    'Redis ì—°ê²°': False,
    'PostgreSQL ì—°ê²°': False,
    'ëª¨ë“ˆ Import': False,
    'íŒŒì¼ ì‹œìŠ¤í…œ': False
}

# 1. Python í™˜ê²½
try:
    import sys
    if sys.version_info >= (3, 8):
        checks['Python í™˜ê²½'] = True
        print('âœ… Python í™˜ê²½: OK')
    else:
        print('âŒ Python í™˜ê²½: ë²„ì „ ë¶€ì¡±')
except:
    print('âŒ Python í™˜ê²½: ì‹¤íŒ¨')

# 2. Redis ì—°ê²°
try:
    import redis
    r = redis.Redis(host='redis')
    r.ping()
    checks['Redis ì—°ê²°'] = True
    print('âœ… Redis ì—°ê²°: OK')
except:
    print('âŒ Redis ì—°ê²°: ì‹¤íŒ¨')

# 3. PostgreSQL ì—°ê²°
try:
    import psycopg2
    conn = psycopg2.connect(host='postgres', database='mlops', user='mlops_user', password='mlops_password')
    conn.close()
    checks['PostgreSQL ì—°ê²°'] = True
    print('âœ… PostgreSQL ì—°ê²°: OK')
except:
    print('âŒ PostgreSQL ì—°ê²°: ì‹¤íŒ¨')

# 4. ëª¨ë“ˆ Import
try:
    import sys
    sys.path.append('/app/src')
    from features.engineering.tmdb_processor import AdvancedTMDBPreProcessor
    from features.store.feature_store import SimpleFeatureStore
    checks['ëª¨ë“ˆ Import'] = True
    print('âœ… ëª¨ë“ˆ Import: OK')
except:
    print('âŒ ëª¨ë“ˆ Import: ì‹¤íŒ¨')

# 5. íŒŒì¼ ì‹œìŠ¤í…œ
try:
    from pathlib import Path
    test_path = Path('/app/data/test_check')
    test_path.mkdir(exist_ok=True)
    test_file = test_path / 'test.txt'
    test_file.write_text('test')
    test_file.unlink()
    test_path.rmdir()
    checks['íŒŒì¼ ì‹œìŠ¤í…œ'] = True
    print('âœ… íŒŒì¼ ì‹œìŠ¤í…œ: OK')
except:
    print('âŒ íŒŒì¼ ì‹œìŠ¤í…œ: ì‹¤íŒ¨')

print('=' * 50)

# ê²°ê³¼ ìš”ì•½
passed = sum(checks.values())
total = len(checks)
success_rate = passed / total * 100

print(f'ğŸ“Š ê²€ì¦ ê²°ê³¼: {passed}/{total} ì„±ê³µ ({success_rate:.1f}%)')

if success_rate >= 100:
    print('ğŸ‰ í™˜ê²½ ê²€ì¦ ì™„ë£Œ! ëª¨ë“  ì‹œìŠ¤í…œì´ ì •ìƒ ë™ì‘í•©ë‹ˆë‹¤.')
elif success_rate >= 80:
    print('âš ï¸ ëŒ€ë¶€ë¶„ì˜ ì‹œìŠ¤í…œì´ ì •ìƒì´ì§€ë§Œ ì¼ë¶€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.')
else:
    print('âŒ í™˜ê²½ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.')

print('=' * 50)
"
```

---

## ğŸ”§ 6. ë¬¸ì œ í•´ê²°

### 6.1 ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œë“¤

#### Docker ì„œë¹„ìŠ¤ ì‹œì‘ ì‹¤íŒ¨
```bash
# ë¬¸ì œ: ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ë˜ì§€ ì•ŠìŒ
# í™•ì¸:
docker compose logs dev
docker compose logs redis
docker compose logs postgres

# í•´ê²°:
docker compose down
docker compose up -d --force-recreate
```

#### í¬íŠ¸ ì¶©ëŒ
```bash
# ë¬¸ì œ: "port is already allocated"
# í™•ì¸:
netstat -tulpn | grep -E ":(5432|6379|8001|8002)"

# í•´ê²°: ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©í•˜ë„ë¡ docker-compose.yml ìˆ˜ì •
```

#### ê¶Œí•œ ë¬¸ì œ
```bash
# ë¬¸ì œ: "Permission denied"
# í™•ì¸:
docker compose exec dev whoami
docker compose exec dev ls -la /app/data

# í•´ê²°:
sudo chown -R $USER:$USER ./data
sudo chmod -R 755 ./data
```

#### ë©”ëª¨ë¦¬ ë¶€ì¡±
```bash
# ë¬¸ì œ: ì»¨í…Œì´ë„ˆê°€ ëŠë¦¬ê±°ë‚˜ ë©ˆì¶¤
# í™•ì¸:
docker stats

# í•´ê²°: docker-compose.ymlì—ì„œ ë©”ëª¨ë¦¬ ì œí•œ ì¦ê°€
```

### 6.2 ë¡œê·¸ í™•ì¸

```bash
# ì „ì²´ ë¡œê·¸ í™•ì¸
docker compose logs -f

# ê°œë³„ ì„œë¹„ìŠ¤ ë¡œê·¸
docker compose logs -f dev
docker compose logs -f redis
docker compose logs -f postgres

# ìµœê·¼ ë¡œê·¸ë§Œ
docker compose logs --tail=50 dev
```

---

## âœ… ì„±ê³µ ê¸°ì¤€

### í•„ìˆ˜ í†µê³¼ í•­ëª©
- [ ] Docker ì»¨í…Œì´ë„ˆ 3ê°œ ëª¨ë‘ Running ìƒíƒœ
- [ ] Redis PONG ì‘ë‹µ ì •ìƒ
- [ ] PostgreSQL ì—°ê²° ì„±ê³µ
- [ ] Python ëª¨ë“ˆ Import ì „ì²´ ì„±ê³µ
- [ ] íŒŒì¼ ì‹œìŠ¤í…œ ì½ê¸°/ì“°ê¸° ì •ìƒ

### ê¶Œì¥ í™•ì¸ í•­ëª©
- [ ] API ì„œë²„ ì •ìƒ ì‹œì‘ (ì„ íƒì‚¬í•­)
- [ ] ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ ì •ìƒ (ì„ íƒì‚¬í•­)
- [ ] ë„¤íŠ¸ì›Œí¬ í†µì‹  ì›í™œ
- [ ] ë¡œê·¸ ê¸°ë¡ ì •ìƒ

**í™˜ê²½ ê²€ì¦ì´ ì™„ë£Œë˜ë©´ ë‹¤ìŒ ë‹¨ê³„ì¸ [2.2-core-component-testing.md](./2.2-core-component-testing.md)ë¡œ ì§„í–‰í•˜ì„¸ìš”!** ğŸš€
