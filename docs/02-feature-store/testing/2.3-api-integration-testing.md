# 2.3 API ë° í†µí•© í…ŒìŠ¤íŠ¸

## ğŸ“‹ ê°œìš”

FastAPI ê¸°ë°˜ í”¼ì²˜ ìŠ¤í† ì–´ API ì„œë²„ì™€ ì™¸ë¶€ í†µí•© ê¸°ëŠ¥ë“¤ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê°€ì´ë“œì…ë‹ˆë‹¤.

---

## ğŸŒ 1. FastAPI ì„œë²„ ì‹œì‘ ë° ê¸°ë³¸ ê²€ì¦

### 1.1 API ì„œë²„ ì‹œì‘

```bash
# API í”„ë¡œíŒŒì¼ë¡œ ì„œë¹„ìŠ¤ ì‹œì‘
docker compose --profile api up -d

# API ì„œë²„ ìƒíƒœ í™•ì¸
docker compose ps | grep api

# ì˜ˆìƒ ì¶œë ¥ì—ì„œ API ì„œë²„ í™•ì¸
# movie-mlops_feature-store-api_1   Up   0.0.0.0:8002->8001/tcp
```

### 1.2 ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸

```bash
# Health Check API í…ŒìŠ¤íŠ¸
echo "ğŸ©º API Health Check í…ŒìŠ¤íŠ¸..."
curl -s http://localhost:8002/health | jq . || echo "Raw ì¶œë ¥:"
curl -s http://localhost:8002/health

# ë£¨íŠ¸ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
echo -e "\nğŸ  ë£¨íŠ¸ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸..."
curl -s http://localhost:8002/ | jq . || curl -s http://localhost:8002/

# API ë¬¸ì„œ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
echo -e "\nğŸ“š API ë¬¸ì„œ ì ‘ê·¼ í…ŒìŠ¤íŠ¸..."
if curl -s http://localhost:8002/docs | grep -q "Swagger"; then
    echo "âœ… Swagger UI ì ‘ê·¼ ê°€ëŠ¥: http://localhost:8002/docs"
else
    echo "âš ï¸ Swagger UI ì ‘ê·¼ ë¶ˆê°€"
fi

if curl -s http://localhost:8002/redoc | grep -q "ReDoc"; then
    echo "âœ… ReDoc ë¬¸ì„œ ì ‘ê·¼ ê°€ëŠ¥: http://localhost:8002/redoc"
else
    echo "âš ï¸ ReDoc ë¬¸ì„œ ì ‘ê·¼ ë¶ˆê°€"
fi
```

---

## ğŸ”Œ 2. API ì—”ë“œí¬ì¸íŠ¸ ì „ì²´ í…ŒìŠ¤íŠ¸

### 2.1 í†µê³„ ì¡°íšŒ API í…ŒìŠ¤íŠ¸

```bash
# í”¼ì²˜ ìŠ¤í† ì–´ í†µê³„ API í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import requests
import json

print('ğŸ“Š í†µê³„ ì¡°íšŒ API í…ŒìŠ¤íŠ¸...')

base_url = 'http://feature-store-api:8001'

try:
    # í†µê³„ ì¡°íšŒ
    response = requests.get(f'{base_url}/stats')
    
    if response.status_code == 200:
        data = response.json()
        print('âœ… í†µê³„ ì¡°íšŒ API ì„±ê³µ')
        
        if 'data' in data:
            stats = data['data']
            print(f'   ì´ í”¼ì²˜: {stats.get(\"total_features\", 0)}ê°œ')
            print(f'   ì´ ê·¸ë£¹: {stats.get(\"total_groups\", 0)}ê°œ')
            print(f'   ì €ì¥ í¬ê¸°: {stats.get(\"total_size_mb\", 0):.2f}MB')
        else:
            print('   ì‘ë‹µ êµ¬ì¡°:', list(data.keys()))
    else:
        print(f'âŒ í†µê³„ ì¡°íšŒ ì‹¤íŒ¨: HTTP {response.status_code}')
        print(f'   ì‘ë‹µ: {response.text}')
        
except Exception as e:
    print(f'âŒ í†µê³„ ì¡°íšŒ ì˜¤ë¥˜: {e}')

print('âœ… í†µê³„ ì¡°íšŒ API í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
"
```

### 2.2 ì˜í™” ë°ì´í„° ì²˜ë¦¬ API í…ŒìŠ¤íŠ¸

```bash
# ì˜í™” ë°ì´í„° ì²˜ë¦¬ API í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import requests
import json

print('ğŸ¬ ì˜í™” ë°ì´í„° ì²˜ë¦¬ API í…ŒìŠ¤íŠ¸...')

base_url = 'http://feature-store-api:8001'

# í…ŒìŠ¤íŠ¸ìš© ì˜í™” ë°ì´í„°
test_movies = [
    {
        'movie_id': 9999,
        'title': 'API Test Movie',
        'overview': 'A test movie for API endpoint validation.',
        'release_date': '2023-01-01',
        'vote_average': 8.0,
        'vote_count': 1000,
        'popularity': 50.0,
        'genre_ids': [28, 12],  # Action, Adventure
        'adult': False,
        'original_language': 'en'
    },
    {
        'movie_id': 9998,
        'title': 'Another API Test',
        'overview': 'Second test movie for comprehensive API testing.',
        'release_date': '2023-06-15',
        'vote_average': 7.5,
        'vote_count': 800,
        'popularity': 40.0,
        'genre_ids': [18],  # Drama
        'adult': False,
        'original_language': 'en'
    }
]

try:
    # ì˜í™” ë°ì´í„° ì²˜ë¦¬ ìš”ì²­
    payload = {
        'movies': test_movies,
        'config': {
            'extraction_type': 'all'
        },
        'save_to_store': True
    }
    
    response = requests.post(
        f'{base_url}/process/movies',
        json=payload,
        headers={'Content-Type': 'application/json'}
    )
    
    if response.status_code == 200:
        data = response.json()
        print('âœ… ì˜í™” ë°ì´í„° ì²˜ë¦¬ API ì„±ê³µ')
        
        if 'data' in data:
            result = data['data']
            print(f'   ì²˜ë¦¬ëœ ì˜í™”: {result.get(\"processed_movies\", 0)}ê°œ')
            print(f'   í”¼ì²˜ ì¹´í…Œê³ ë¦¬: {result.get(\"feature_categories\", [])}')
            
            if result.get('saved_to_store', False):
                print('   í”¼ì²˜ ìŠ¤í† ì–´ ì €ì¥: âœ…')
            else:
                print('   í”¼ì²˜ ìŠ¤í† ì–´ ì €ì¥: âŒ')
        else:
            print('   ì‘ë‹µ êµ¬ì¡°:', list(data.keys()))
    else:
        print(f'âŒ ì˜í™” ë°ì´í„° ì²˜ë¦¬ ì‹¤íŒ¨: HTTP {response.status_code}')
        print(f'   ì‘ë‹µ: {response.text}')
        
except Exception as e:
    print(f'âŒ ì˜í™” ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜: {e}')

print('âœ… ì˜í™” ë°ì´í„° ì²˜ë¦¬ API í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
"
```

### 2.3 í”¼ì²˜ ì €ì¥/ì¡°íšŒ API í…ŒìŠ¤íŠ¸

```bash
# í”¼ì²˜ ì €ì¥ ë° ì¡°íšŒ API í†µí•© í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import requests
import json

print('ğŸ’¾ğŸ“‹ í”¼ì²˜ ì €ì¥/ì¡°íšŒ API í†µí•© í…ŒìŠ¤íŠ¸...')

base_url = 'http://feature-store-api:8001'

# 1. í”¼ì²˜ ë°ì´í„° ì €ì¥
print('1ï¸âƒ£ í”¼ì²˜ ë°ì´í„° ì €ì¥...')

test_feature_data = {
    'api_test_movies': {
        'data': [
            {'movie_id': 1, 'popularity': 85.5, 'vote_average': 8.2, 'genre_action': 1},
            {'movie_id': 2, 'popularity': 72.3, 'vote_average': 7.8, 'genre_action': 0},
            {'movie_id': 3, 'popularity': 91.7, 'vote_average': 8.9, 'genre_action': 1}
        ],
        'columns': ['movie_id', 'popularity', 'vote_average', 'genre_action'],
        'dtypes': {
            'movie_id': 'int64',
            'popularity': 'float64', 
            'vote_average': 'float64',
            'genre_action': 'int64'
        },
        'shape': [3, 4]
    }
}

try:
    # ì €ì¥ ìš”ì²­
    save_payload = {
        'feature_group': 'api_test_group',
        'features_data': test_feature_data
    }
    
    save_response = requests.post(
        f'{base_url}/features/save',
        json=save_payload,
        headers={'Content-Type': 'application/json'}
    )
    
    if save_response.status_code == 200:
        save_data = save_response.json()
        print('   âœ… í”¼ì²˜ ì €ì¥ ì„±ê³µ')
        
        if 'saved_paths' in save_data:
            saved_paths = save_data['saved_paths']
            print(f'   ì €ì¥ëœ íŒŒì¼: {len(saved_paths)}ê°œ')
    else:
        print(f'   âŒ í”¼ì²˜ ì €ì¥ ì‹¤íŒ¨: HTTP {save_response.status_code}')
        print(f'   ì‘ë‹µ: {save_response.text}')
        exit(1)
    
    # 2. í”¼ì²˜ ë°ì´í„° ì¡°íšŒ
    print('2ï¸âƒ£ í”¼ì²˜ ë°ì´í„° ì¡°íšŒ...')
    
    get_payload = {
        'feature_names': ['api_test_movies'],
        'feature_group': 'api_test_group'
    }
    
    get_response = requests.post(
        f'{base_url}/features/get',
        json=get_payload,
        headers={'Content-Type': 'application/json'}
    )
    
    if get_response.status_code == 200:
        get_data = get_response.json()
        print('   âœ… í”¼ì²˜ ì¡°íšŒ ì„±ê³µ')
        
        if 'data' in get_data and get_data['data']:
            features = get_data['data']
            print(f'   ì¡°íšŒëœ í”¼ì²˜: {len(features)}ê°œ')
            
            for feature_name, feature_data in features.items():
                if isinstance(feature_data, dict) and 'data' in feature_data:
                    records = len(feature_data['data'])
                    columns = len(feature_data.get('columns', []))
                    print(f'     {feature_name}: {records}í–‰ x {columns}ì»¬ëŸ¼')
                    
                    # ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦
                    original_records = len(test_feature_data['api_test_movies']['data'])
                    if records == original_records:
                        print('     âœ… ë°ì´í„° ë¬´ê²°ì„± í™•ì¸')
                    else:
                        print('     âŒ ë°ì´í„° ë¬´ê²°ì„± ì‹¤íŒ¨')
        else:
            print('   âŒ ì¡°íšŒëœ ë°ì´í„° ì—†ìŒ')
            
    elif get_response.status_code == 404:
        print('   âš ï¸ í”¼ì²˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ')
    else:
        print(f'   âŒ í”¼ì²˜ ì¡°íšŒ ì‹¤íŒ¨: HTTP {get_response.status_code}')
    
    print('âœ… í”¼ì²˜ ì €ì¥/ì¡°íšŒ API í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
    
except Exception as e:
    print(f'âŒ í†µí•© í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: {e}')
"
```

---

## ğŸ§ª 3. API í†µí•© ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

### 3.1 ì „ì²´ API ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸

```bash
# ì „ì²´ API ì›Œí¬í”Œë¡œìš° í†µí•© í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import requests
import json
import time

print('ğŸ”„ ì „ì²´ API ì›Œí¬í”Œë¡œìš° í†µí•© í…ŒìŠ¤íŠ¸...')

base_url = 'http://feature-store-api:8001'

try:
    # 1. ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
    print('1ï¸âƒ£ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸...')
    health_response = requests.get(f'{base_url}/health')
    if health_response.status_code == 200:
        print('   âœ… ì‹œìŠ¤í…œ ì •ìƒ')
    else:
        print('   âŒ ì‹œìŠ¤í…œ ì´ìƒ')
        exit(1)
    
    # 2. ì´ˆê¸° í†µê³„ í™•ì¸
    print('2ï¸âƒ£ ì´ˆê¸° í†µê³„ í™•ì¸...')
    stats_response = requests.get(f'{base_url}/stats')
    if stats_response.status_code == 200:
        initial_stats = stats_response.json()['data']
        initial_features = initial_stats.get('total_features', 0)
        print(f'   ì´ˆê¸° í”¼ì²˜ ìˆ˜: {initial_features}ê°œ')
    
    # 3. ì˜í™” ë°ì´í„° ì²˜ë¦¬
    print('3ï¸âƒ£ ì˜í™” ë°ì´í„° ì²˜ë¦¬...')
    workflow_movies = [
        {
            'movie_id': 7777,
            'title': 'Workflow Test Movie',
            'overview': 'Testing complete API workflow',
            'release_date': '2023-01-01',
            'vote_average': 8.5,
            'vote_count': 1500,
            'popularity': 60.0,
            'genre_ids': [28, 878],
            'adult': False,
            'original_language': 'en'
        }
    ]
    
    process_payload = {
        'movies': workflow_movies,
        'config': {'extraction_type': 'all'},
        'save_to_store': True
    }
    
    process_response = requests.post(
        f'{base_url}/process/movies',
        json=process_payload
    )
    
    if process_response.status_code == 200:
        process_result = process_response.json()['data']
        print(f'   ì²˜ë¦¬ ì™„ë£Œ: {process_result.get(\"processed_movies\", 0)}ê°œ ì˜í™”')
    else:
        print(f'   âŒ ì²˜ë¦¬ ì‹¤íŒ¨: {process_response.status_code}')
    
    # 4. í†µê³„ ë³€í™” í™•ì¸
    print('4ï¸âƒ£ í†µê³„ ë³€í™” í™•ì¸...')
    time.sleep(1)  # ì ì‹œ ëŒ€ê¸°
    
    final_stats_response = requests.get(f'{base_url}/stats')
    if final_stats_response.status_code == 200:
        final_stats = final_stats_response.json()['data']
        final_features = final_stats.get('total_features', 0)
        print(f'   ìµœì¢… í”¼ì²˜ ìˆ˜: {final_features}ê°œ')
        
        if final_features >= initial_features:
            print('   âœ… í”¼ì²˜ ìˆ˜ ìœ ì§€/ì¦ê°€ í™•ì¸ë¨')
        else:
            print('   âš ï¸ í”¼ì²˜ ìˆ˜ ê°ì†Œ')
    
    # 5. ë°±ì—… ì‹¤í–‰
    print('5ï¸âƒ£ ë°±ì—… ì‹¤í–‰...')
    backup_response = requests.post(f'{base_url}/backup')
    if backup_response.status_code == 200:
        print('   âœ… ë°±ì—… ì„±ê³µ')
    else:
        print('   âš ï¸ ë°±ì—… ì‹¤íŒ¨')
    
    print('ğŸ‰ ì „ì²´ API ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ì„±ê³µ!')
    
except Exception as e:
    print(f'âŒ ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}')
    import traceback
    traceback.print_exc()
"
```

### 3.2 API ì˜¤ë¥˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

```bash
# API ì˜¤ë¥˜ ì²˜ë¦¬ ë° ì˜ˆì™¸ ìƒí™© í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import requests
import json

print('âš ï¸ API ì˜¤ë¥˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸...')

base_url = 'http://feature-store-api:8001'

# 1. ì˜ëª»ëœ ë°ì´í„° í˜•ì‹ í…ŒìŠ¤íŠ¸
print('1ï¸âƒ£ ì˜ëª»ëœ ë°ì´í„° í˜•ì‹ í…ŒìŠ¤íŠ¸...')
try:
    invalid_payload = {
        'movies': 'invalid_data_type',  # ë¦¬ìŠ¤íŠ¸ê°€ ì•„ë‹Œ ë¬¸ìì—´
        'config': {},
        'save_to_store': True
    }
    
    response = requests.post(f'{base_url}/process/movies', json=invalid_payload)
    
    if response.status_code == 422:  # Validation Error
        print('   âœ… ë°ì´í„° ê²€ì¦ ì˜¤ë¥˜ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•¨')
    elif response.status_code == 400:  # Bad Request
        print('   âœ… ì˜ëª»ëœ ìš”ì²­ì„ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•¨')
    else:
        print(f'   âš ï¸ ì˜ˆìƒê³¼ ë‹¤ë¥¸ ì‘ë‹µ: {response.status_code}')
    
except Exception as e:
    print(f'   âŒ ì˜¤ë¥˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}')

# 2. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í”¼ì²˜ ì¡°íšŒ í…ŒìŠ¤íŠ¸
print('2ï¸âƒ£ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í”¼ì²˜ ì¡°íšŒ í…ŒìŠ¤íŠ¸...')
try:
    nonexistent_payload = {
        'feature_names': ['nonexistent_feature'],
        'feature_group': 'nonexistent_group'
    }
    
    response = requests.post(f'{base_url}/features/get', json=nonexistent_payload)
    
    if response.status_code == 404:  # Not Found
        print('   âœ… ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í”¼ì²˜ì— ëŒ€í•´ ì˜¬ë°”ë¥¸ 404 ì‘ë‹µ')
    elif response.status_code == 200:
        data = response.json()
        if not data.get('data'):
            print('   âœ… ë¹ˆ ê²°ê³¼ë¥¼ ì˜¬ë°”ë¥´ê²Œ ë°˜í™˜í•¨')
    else:
        print(f'   âš ï¸ ì˜ˆìƒê³¼ ë‹¤ë¥¸ ì‘ë‹µ: {response.status_code}')
    
except Exception as e:
    print(f'   âŒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í”¼ì²˜ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}')

# 3. ì˜ëª»ëœ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
print('3ï¸âƒ£ ì˜ëª»ëœ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸...')
try:
    response = requests.get(f'{base_url}/nonexistent/endpoint')
    
    if response.status_code == 404:
        print('   âœ… ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•´ ì˜¬ë°”ë¥¸ 404 ì‘ë‹µ')
    else:
        print(f'   âš ï¸ ì˜ˆìƒê³¼ ë‹¤ë¥¸ ì‘ë‹µ: {response.status_code}')
    
except Exception as e:
    print(f'   âŒ ì˜ëª»ëœ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}')

print('âœ… API ì˜¤ë¥˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
"
```

---

## ğŸ“Š 4. API ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

### 4.1 ì‘ë‹µ ì‹œê°„ í…ŒìŠ¤íŠ¸

```bash
# API ì‘ë‹µ ì‹œê°„ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import requests
import time
import statistics

print('â±ï¸ API ì‘ë‹µ ì‹œê°„ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸...')

base_url = 'http://feature-store-api:8001'

# ê° ì—”ë“œí¬ì¸íŠ¸ë³„ ì‘ë‹µ ì‹œê°„ ì¸¡ì •
endpoints = [
    ('GET', '/health', 'Health Check'),
    ('GET', '/stats', 'í†µê³„ ì¡°íšŒ'),
    ('GET', '/features/list', 'í”¼ì²˜ ëª©ë¡')
]

results = {}

for method, endpoint, name in endpoints:
    print(f'ğŸ” {name} í…ŒìŠ¤íŠ¸...')
    
    times = []
    for i in range(5):  # 5ë²ˆ ì¸¡ì •
        start_time = time.time()
        
        try:
            if method == 'GET':
                response = requests.get(f'{base_url}{endpoint}')
            else:
                response = requests.post(f'{base_url}{endpoint}', json={})
            
            end_time = time.time()
            response_time = (end_time - start_time) * 1000  # ms ë‹¨ìœ„
            
            if response.status_code == 200:
                times.append(response_time)
            
        except Exception as e:
            print(f'   ìš”ì²­ {i+1} ì‹¤íŒ¨: {e}')
    
    if times:
        avg_time = statistics.mean(times)
        min_time = min(times)
        max_time = max(times)
        
        results[name] = {
            'avg': avg_time,
            'min': min_time,
            'max': max_time
        }
        
        print(f'   í‰ê· : {avg_time:.2f}ms, ìµœì†Œ: {min_time:.2f}ms, ìµœëŒ€: {max_time:.2f}ms')
        
        if avg_time <= 100:
            print('   âœ… ì‘ë‹µ ì‹œê°„ ìš°ìˆ˜ (â‰¤100ms)')
        elif avg_time <= 500:
            print('   âš ï¸ ì‘ë‹µ ì‹œê°„ ë³´í†µ (â‰¤500ms)')
        else:
            print('   âŒ ì‘ë‹µ ì‹œê°„ ê°œì„  í•„ìš” (>500ms)')
    else:
        print('   âŒ ìœ íš¨í•œ ì‘ë‹µ ì—†ìŒ')

print('\nğŸ“Š ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ìš”ì•½:')
for name, metrics in results.items():
    print(f'  {name}: {metrics[\"avg\"]:.2f}ms (í‰ê· )')

print('âœ… API ì‘ë‹µ ì‹œê°„ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
"
```

### 4.2 ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

```bash
# API ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import requests
import threading
import time
from concurrent.futures import ThreadPoolExecutor, as_completed

print('ğŸš€ API ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸...')

base_url = 'http://feature-store-api:8001'

def make_request(request_id):
    '''ë‹¨ì¼ ìš”ì²­ í•¨ìˆ˜'''
    try:
        start_time = time.time()
        response = requests.get(f'{base_url}/health', timeout=10)
        end_time = time.time()
        
        return {
            'id': request_id,
            'status_code': response.status_code,
            'response_time': (end_time - start_time) * 1000,
            'success': response.status_code == 200
        }
    except Exception as e:
        return {
            'id': request_id,
            'error': str(e),
            'success': False
        }

# ë™ì‹œ ìš”ì²­ í…ŒìŠ¤íŠ¸ (10ê°œ ìŠ¤ë ˆë“œ)
print('ğŸ“¡ 10ê°œ ë™ì‹œ ìš”ì²­ í…ŒìŠ¤íŠ¸...')
concurrent_requests = 10

start_time = time.time()
with ThreadPoolExecutor(max_workers=concurrent_requests) as executor:
    futures = [executor.submit(make_request, i) for i in range(concurrent_requests)]
    results = [future.result() for future in as_completed(futures)]

total_time = time.time() - start_time

# ê²°ê³¼ ë¶„ì„
successful_requests = [r for r in results if r.get('success', False)]
failed_requests = [r for r in results if not r.get('success', False)]

print(f'ğŸ“Š ë™ì‹œ ìš”ì²­ í…ŒìŠ¤íŠ¸ ê²°ê³¼:')
print(f'   ì´ ìš”ì²­: {concurrent_requests}ê°œ')
print(f'   ì„±ê³µ: {len(successful_requests)}ê°œ')
print(f'   ì‹¤íŒ¨: {len(failed_requests)}ê°œ')
print(f'   ì„±ê³µë¥ : {len(successful_requests)/concurrent_requests*100:.1f}%')
print(f'   ì´ ì†Œìš” ì‹œê°„: {total_time:.2f}ì´ˆ')

if successful_requests:
    response_times = [r['response_time'] for r in successful_requests]
    avg_response_time = sum(response_times) / len(response_times)
    max_response_time = max(response_times)
    min_response_time = min(response_times)
    
    print(f'   í‰ê·  ì‘ë‹µ ì‹œê°„: {avg_response_time:.2f}ms')
    print(f'   ìµœëŒ€ ì‘ë‹µ ì‹œê°„: {max_response_time:.2f}ms')
    print(f'   ìµœì†Œ ì‘ë‹µ ì‹œê°„: {min_response_time:.2f}ms')

# ì„±ëŠ¥ í‰ê°€
if len(successful_requests) >= concurrent_requests * 0.9:  # 90% ì„±ê³µë¥ 
    print('âœ… ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ ì„±ëŠ¥ ìš°ìˆ˜')
elif len(successful_requests) >= concurrent_requests * 0.7:  # 70% ì„±ê³µë¥ 
    print('âš ï¸ ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ ì„±ëŠ¥ ë³´í†µ')
else:
    print('âŒ ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ ì„±ëŠ¥ ê°œì„  í•„ìš”')

print('âœ… ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
"
```

---

## ğŸ”— 5. ì™¸ë¶€ í†µí•© í…ŒìŠ¤íŠ¸

### 5.1 TMDB API ì—°ë™ í…ŒìŠ¤íŠ¸ (ì„ íƒì‚¬í•­)

```bash
# ì‹¤ì œ TMDB API ì—°ë™ í…ŒìŠ¤íŠ¸ (API í‚¤ í•„ìš”)
docker compose exec dev python -c "
import os
import requests

print('ğŸ¬ TMDB API ì—°ë™ í…ŒìŠ¤íŠ¸...')

# API í‚¤ í™•ì¸
api_key = os.getenv('TMDB_API_KEY')
if not api_key:
    print('âš ï¸ TMDB_API_KEY í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ')
    print('   ì‹¤ì œ TMDB ì—°ë™ í…ŒìŠ¤íŠ¸ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.')
    exit(0)

print(f'âœ… TMDB API í‚¤ ì„¤ì •ë¨: {api_key[:8]}...')

try:
    # TMDB API í˜¸ì¶œ
    tmdb_base_url = 'https://api.themoviedb.org/3'
    response = requests.get(f'{tmdb_base_url}/movie/popular', params={'api_key': api_key})
    
    if response.status_code == 200:
        data = response.json()
        movies = data.get('results', [])[:3]  # ì²˜ìŒ 3ê°œë§Œ
        
        print(f'âœ… TMDB API í˜¸ì¶œ ì„±ê³µ: {len(movies)}ê°œ ì˜í™” ì¡°íšŒ')
        
        # ë‚´ë¶€ APIë¡œ ì‹¤ì œ ë°ì´í„° ì²˜ë¦¬
        base_url = 'http://feature-store-api:8001'
        
        # TMDB ë°ì´í„°ë¥¼ ë‚´ë¶€ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        converted_movies = []
        for movie in movies:
            converted_movie = {
                'movie_id': movie['id'],
                'title': movie['title'],
                'overview': movie.get('overview', ''),
                'release_date': movie.get('release_date', ''),
                'vote_average': movie.get('vote_average', 0),
                'vote_count': movie.get('vote_count', 0),
                'popularity': movie.get('popularity', 0),
                'genre_ids': movie.get('genre_ids', []),
                'adult': movie.get('adult', False),
                'original_language': movie.get('original_language', 'en')
            }
            converted_movies.append(converted_movie)
        
        # ë‚´ë¶€ APIë¡œ ì²˜ë¦¬
        process_payload = {
            'movies': converted_movies,
            'config': {'extraction_type': 'basic'},
            'save_to_store': True
        }
        
        process_response = requests.post(f'{base_url}/process/movies', json=process_payload)
        
        if process_response.status_code == 200:
            result = process_response.json()['data']
            print(f'âœ… ì‹¤ì œ TMDB ë°ì´í„° ì²˜ë¦¬ ì„±ê³µ: {result.get(\"processed_movies\", 0)}ê°œ')
        else:
            print(f'âŒ ì‹¤ì œ TMDB ë°ì´í„° ì²˜ë¦¬ ì‹¤íŒ¨: {process_response.status_code}')
    
    else:
        print(f'âŒ TMDB API í˜¸ì¶œ ì‹¤íŒ¨: {response.status_code}')
        
except Exception as e:
    print(f'âŒ TMDB ì—°ë™ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}')

print('âœ… TMDB API ì—°ë™ í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
"
```

---

## âœ… ì„±ê³µ ê¸°ì¤€

### API ê¸°ë³¸ ê¸°ëŠ¥
- [ ] Health Check API ì •ìƒ ì‘ë‹µ
- [ ] í†µê³„ ì¡°íšŒ API ì •ìƒ ë™ì‘
- [ ] í”¼ì²˜ ëª©ë¡ ì¡°íšŒ API ì •ìƒ ë™ì‘
- [ ] ì˜í™” ë°ì´í„° ì²˜ë¦¬ API ì •ìƒ ë™ì‘
- [ ] í”¼ì²˜ ì €ì¥/ì¡°íšŒ API ì •ìƒ ë™ì‘
- [ ] ë°±ì—… API ì •ìƒ ë™ì‘

### API ë¬¸ì„œ ë° ì ‘ê·¼ì„±
- [ ] Swagger UI ì ‘ê·¼ ê°€ëŠ¥
- [ ] ReDoc ë¬¸ì„œ ì ‘ê·¼ ê°€ëŠ¥
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ë¬¸ì„œí™” ì™„ë£Œ

### ì˜¤ë¥˜ ì²˜ë¦¬
- [ ] ì˜ëª»ëœ ë°ì´í„° í˜•ì‹ ì ì ˆíˆ ì²˜ë¦¬
- [ ] ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ 404 ì‘ë‹µ
- [ ] ì˜ëª»ëœ ì—”ë“œí¬ì¸íŠ¸ 404 ì‘ë‹µ
- [ ] ì ì ˆí•œ HTTP ìƒíƒœ ì½”ë“œ ë°˜í™˜

### ì„±ëŠ¥ ê¸°ì¤€
- [ ] í‰ê·  ì‘ë‹µ ì‹œê°„ â‰¤ 100ms (ë‹¨ìˆœ ì¡°íšŒ)
- [ ] ë™ì‹œ ìš”ì²­ ì„±ê³µë¥  â‰¥ 90%
- [ ] ë°ì´í„° ì²˜ë¦¬ API â‰¤ 5ì´ˆ (10ê°œ ì˜í™”)

### í†µí•© ê¸°ëŠ¥
- [ ] End-to-End ì›Œí¬í”Œë¡œìš° ì •ìƒ ë™ì‘
- [ ] ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥
- [ ] ì™¸ë¶€ API ì—°ë™ ê°€ëŠ¥ (ì„ íƒì‚¬í•­)

**API ë° í†µí•© í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ë©´ ë‹¤ìŒ ë‹¨ê³„ì¸ [2.4-performance-testing.md](./2.4-performance-testing.md)ë¡œ ì§„í–‰í•˜ì„¸ìš”!** ğŸš€
