# 2.6 ëª¨ë‹ˆí„°ë§ ë° ë©”íŠ¸ë¦­ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì´ ê°€ì´ë“œëŠ” **í”¼ì²˜ ìŠ¤í† ì–´ ì‹œìŠ¤í…œì˜ ëª¨ë‹ˆí„°ë§ ë° ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ê¸°ëŠ¥**ì„ ì™„ì „íˆ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤. Prometheus, Grafana, ê·¸ë¦¬ê³  ì‚¬ìš©ì ì •ì˜ ë©”íŠ¸ë¦­ ì‹œìŠ¤í…œì„ ê²€ì¦í•©ë‹ˆë‹¤.

### ğŸ¯ í…ŒìŠ¤íŠ¸ ë²”ìœ„
- âœ… **Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘**: ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ ë° ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­
- âœ… **Grafana ëŒ€ì‹œë³´ë“œ**: ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ë° ì‹œê°í™”
- âœ… **ì•Œë¦¼ ì‹œìŠ¤í…œ**: ì„ê³„ê°’ ê¸°ë°˜ ì•Œë¦¼ ë° ì•ŒëŒ
- âœ… **ë¡œê·¸ ë¶„ì„**: êµ¬ì¡°í™”ëœ ë¡œê·¸ ë° ì˜¤ë¥˜ ì¶”ì 
- âœ… **ì„±ëŠ¥ ë©”íŠ¸ë¦­**: ì‘ë‹µ ì‹œê°„, ì²˜ë¦¬ëŸ‰, ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
- âœ… **í—¬ìŠ¤ì²´í¬**: ì„œë¹„ìŠ¤ ìƒíƒœ ëª¨ë‹ˆí„°ë§

---

## ğŸš€ 1. í™˜ê²½ ì„¤ì • ë° ê¸°ë³¸ ê²€ì¦

### 1.1 ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ ì‹œì‘

```bash
# ëª¨ë‹ˆí„°ë§ í”„ë¡œíŒŒì¼ë¡œ ì „ì²´ ì‹œìŠ¤í…œ ì‹œì‘
docker compose --profile api --profile monitoring up -d

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker compose ps

# ì˜ˆìƒ ê²°ê³¼:
# prometheus      Up      9090/tcp
# grafana         Up      3000/tcp
# feature-store-api  Up   8001/tcp
# redis           Up      6379/tcp
# postgres        Up      5432/tcp
```

### 1.2 Prometheus ì„œë²„ ê¸°ë³¸ ê²€ì¦

```bash
# Prometheus í—¬ìŠ¤ì²´í¬
docker compose exec dev python -c "
import requests
import json

print('ğŸ“Š Prometheus ì„œë²„ ê¸°ë³¸ ê²€ì¦...')

try:
    # ì„œë²„ ìƒíƒœ í™•ì¸
    health_response = requests.get('http://prometheus:9090/-/healthy', timeout=10)
    if health_response.status_code == 200:
        print('âœ… Prometheus ì„œë²„: ì •ìƒ ë™ì‘')
    else:
        print(f'âŒ Prometheus ì„œë²„: ìƒíƒœ ì½”ë“œ {health_response.status_code}')
        exit(1)
        
    # ì„¤ì • í™•ì¸
    config_response = requests.get('http://prometheus:9090/api/v1/status/config')
    if config_response.status_code == 200:
        print('âœ… Prometheus ì„¤ì •: ë¡œë“œ ì™„ë£Œ')
    else:
        print('âš ï¸ Prometheus ì„¤ì •: í™•ì¸ ë¶ˆê°€')
        
    # íƒ€ê²Ÿ í™•ì¸
    targets_response = requests.get('http://prometheus:9090/api/v1/targets')
    if targets_response.status_code == 200:
        targets_data = targets_response.json()
        active_targets = targets_data['data']['activeTargets']
        print(f'âœ… í™œì„± íƒ€ê²Ÿ: {len(active_targets)}ê°œ')
        
        for target in active_targets:
            health = target['health']
            job = target['labels']['job']
            print(f'  - {job}: {health}')
    else:
        print('âš ï¸ íƒ€ê²Ÿ ì •ë³´: í™•ì¸ ë¶ˆê°€')
        
except Exception as e:
    print(f'âŒ Prometheus ì—°ê²° ì‹¤íŒ¨: {e}')
    exit(1)

print('âœ… Prometheus ê¸°ë³¸ ê²€ì¦ ì™„ë£Œ')
"
```

### 1.3 Grafana ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ í™•ì¸

```bash
# Grafana ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸
echo "ğŸ¨ Grafana ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ í…ŒìŠ¤íŠ¸..."

if curl -s http://localhost:3000/login | grep -q "Grafana"; then
    echo "âœ… Grafana ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ê°€ëŠ¥"
    echo "   URL: http://localhost:3000"
    echo "   ê¸°ë³¸ ê³„ì •: admin / admin123"
else
    echo "âŒ Grafana ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ë¶ˆê°€"
fi

# API í—¬ìŠ¤ì²´í¬
if curl -s http://localhost:3000/api/health | grep -q "ok"; then
    echo "âœ… Grafana API: ì •ìƒ ë™ì‘"
else
    echo "âš ï¸ Grafana API: í™•ì¸ ë¶ˆê°€"
fi
```

---

## ğŸ“ˆ 2. í”¼ì²˜ ìŠ¤í† ì–´ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸

### 2.1 ê¸°ë³¸ ë©”íŠ¸ë¦­ ìƒì„± ë° ìˆ˜ì§‘

```bash
# í”¼ì²˜ ìŠ¤í† ì–´ ì‚¬ìš©í•˜ì—¬ ë©”íŠ¸ë¦­ ìƒì„±
docker compose exec dev python -c "
import sys
sys.path.append('/app/src')
import time
import requests

from features.store.feature_store import SimpleFeatureStore, FeatureStoreConfig
from features.engineering.tmdb_processor import AdvancedTMDBPreProcessor
import pandas as pd

print('ğŸ“ˆ í”¼ì²˜ ìŠ¤í† ì–´ ë©”íŠ¸ë¦­ ìƒì„± í…ŒìŠ¤íŠ¸...')

# ë©”íŠ¸ë¦­ ìˆ˜ì§‘ì´ ê°€ëŠ¥í•œ í”¼ì²˜ ìŠ¤í† ì–´ ì„¤ì •
config = FeatureStoreConfig(
    base_path='/app/data/metrics_test_store',
    cache_enabled=True,
    metrics_enabled=True
)

store = SimpleFeatureStore(config)

# ë‹¤ì–‘í•œ ì‘ì—… ìˆ˜í–‰í•˜ì—¬ ë©”íŠ¸ë¦­ ìƒì„±
print('ğŸ”„ ë©”íŠ¸ë¦­ ìƒì„±ì„ ìœ„í•œ ì‘ì—… ìˆ˜í–‰...')

for i in range(10):
    # í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
    test_movies = [
        {
            'movie_id': i + 1000,
            'title': f'Metrics Test Movie {i+1}',
            'release_date': '2023-06-15',
            'vote_average': 7.5 + (i % 5) * 0.3,
            'vote_count': 1000 + i * 100,
            'popularity': 50.0 + i * 2,
            'genre_ids': [28, 12, 878],
            'adult': False,
            'original_language': 'en',
            'overview': f'Metrics test movie {i+1} for monitoring validation'
        }
    ]
    
    # í”¼ì²˜ ìƒì„±
    processor = AdvancedTMDBPreProcessor(test_movies)
    features = processor.extract_all_features()
    
    # í”¼ì²˜ ì €ì¥ (ë©”íŠ¸ë¦­ ìƒì„±)
    basic_features = features.get('basic')
    if basic_features is not None:
        store.save_features(f'metrics_test_group_{i}', {'metrics_test_feature': basic_features})
    
    # í”¼ì²˜ ì¡°íšŒ (ë©”íŠ¸ë¦­ ìƒì„±)
    loaded = store.get_features(['metrics_test_feature'], f'metrics_test_group_{i}')
    
    # ì§§ì€ ëŒ€ê¸°
    time.sleep(0.5)

print(f'âœ… {10}íšŒ ì‘ì—… ì™„ë£Œ - ë©”íŠ¸ë¦­ ë°ì´í„° ìƒì„±ë¨')

# ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í™•ì¸
print('\nğŸ“Š ìƒì„±ëœ ë©”íŠ¸ë¦­ í™•ì¸...')

# ì ì‹œ ëŒ€ê¸°í•˜ì—¬ ë©”íŠ¸ë¦­ì´ ìˆ˜ì§‘ë˜ë„ë¡ í•¨
time.sleep(5)

metrics_to_check = [
    'feature_store_requests_total',
    'feature_store_request_duration_seconds',
    'feature_store_cache_hits_total',
    'feature_store_cache_misses_total',
    'feature_store_features_total',
    'feature_store_storage_bytes',
    'feature_store_errors_total'
]

for metric in metrics_to_check:
    try:
        response = requests.get(f'http://prometheus:9090/api/v1/query?query={metric}')
        if response.status_code == 200:
            data = response.json()
            if data['data']['result']:
                result = data['data']['result'][0]
                value = result['value'][1]
                print(f'  âœ… {metric}: {value}')
            else:
                print(f'  âš ï¸ {metric}: ë°ì´í„° ì—†ìŒ')
        else:
            print(f'  âŒ {metric}: ì¿¼ë¦¬ ì‹¤íŒ¨ ({response.status_code})')
    except Exception as e:
        print(f'  âŒ {metric}: ì˜¤ë¥˜ - {e}')

print('\nâœ… í”¼ì²˜ ìŠ¤í† ì–´ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
"
```

---

## ğŸ“Š 3. Grafana ëŒ€ì‹œë³´ë“œ í…ŒìŠ¤íŠ¸

### 3.1 ë°ì´í„° ì†ŒìŠ¤ ì„¤ì • í™•ì¸

```bash
# Grafana ë°ì´í„° ì†ŒìŠ¤ í™•ì¸
docker compose exec dev python -c "
import requests
import json

print('ğŸ“Š Grafana ë°ì´í„° ì†ŒìŠ¤ í™•ì¸...')

# Grafana API ì„¤ì •
grafana_url = 'http://grafana:3000'
auth = ('admin', 'admin123')

try:
    # ë°ì´í„° ì†ŒìŠ¤ ëª©ë¡ ì¡°íšŒ
    response = requests.get(f'{grafana_url}/api/datasources', auth=auth)
    
    if response.status_code == 200:
        datasources = response.json()
        print(f'âœ… ì„¤ì •ëœ ë°ì´í„° ì†ŒìŠ¤: {len(datasources)}ê°œ')
        
        for ds in datasources:
            name = ds['name']
            type_name = ds['type']
            url = ds['url']
            access = ds['access']
            print(f'  - {name} ({type_name}): {url} ({access})')
            
            # ë°ì´í„° ì†ŒìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
            test_response = requests.post(f'{grafana_url}/api/datasources/{ds[\"id\"]}/health', auth=auth)
            if test_response.status_code == 200:
                test_result = test_response.json()
                status = test_result.get('status', 'unknown')
                message = test_result.get('message', '')
                print(f'    ì—°ê²° ìƒíƒœ: {status} - {message}')
            else:
                print(f'    ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {test_response.status_code}')
    else:
        print(f'âŒ ë°ì´í„° ì†ŒìŠ¤ ì¡°íšŒ ì‹¤íŒ¨: {response.status_code}')
        
except Exception as e:
    print(f'âŒ Grafana API ì—°ê²° ì‹¤íŒ¨: {e}')

print('\nâœ… Grafana ë°ì´í„° ì†ŒìŠ¤ í™•ì¸ ì™„ë£Œ')
"
```

---

## ğŸš¨ 4. ì•Œë¦¼ ë° ì•ŒëŒ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸

### 4.1 ì•Œë¦¼ ê·œì¹™ ì„¤ì • ë° í…ŒìŠ¤íŠ¸

```bash
# Prometheus ì•Œë¦¼ ê·œì¹™ í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import requests
import json
import time

print('ğŸš¨ Prometheus ì•Œë¦¼ ê·œì¹™ í…ŒìŠ¤íŠ¸...')

try:
    # ì•Œë¦¼ ê·œì¹™ ìƒíƒœ í™•ì¸
    rules_response = requests.get('http://prometheus:9090/api/v1/rules')
    
    if rules_response.status_code == 200:
        rules_data = rules_response.json()
        rule_groups = rules_data['data']['groups']
        
        print(f'âœ… ì•Œë¦¼ ê·œì¹™ ê·¸ë£¹: {len(rule_groups)}ê°œ')
        
        total_rules = 0
        active_alerts = 0
        
        for group in rule_groups:
            group_name = group['name']
            rules = group['rules']
            print(f'  ğŸ“‹ ê·¸ë£¹: {group_name} ({len(rules)}ê°œ ê·œì¹™)')
            
            for rule in rules:
                total_rules += 1
                rule_name = rule['name']
                rule_type = rule['type']
                state = rule.get('state', 'unknown')
                
                print(f'    - {rule_name} ({rule_type}): {state}')
                
                if rule_type == 'alerting' and state == 'firing':
                    active_alerts += 1
                    alerts = rule.get('alerts', [])
                    for alert in alerts:
                        labels = alert.get('labels', {})
                        print(f'      ğŸ”¥ ì•Œë¦¼ ë°œìƒ: {labels}')
        
        print(f'\nğŸ“Š ì•Œë¦¼ ê·œì¹™ ìš”ì•½:')
        print(f'  ì´ ê·œì¹™: {total_rules}ê°œ')
        print(f'  í™œì„± ì•Œë¦¼: {active_alerts}ê°œ')
        
    else:
        print(f'âŒ ì•Œë¦¼ ê·œì¹™ ì¡°íšŒ ì‹¤íŒ¨: {rules_response.status_code}')

except Exception as e:
    print(f'âŒ ì•Œë¦¼ ê·œì¹™ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}')

print('\nâœ… ì•Œë¦¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
"
```

---

## ğŸ“‹ 5. ë¡œê·¸ ë¶„ì„ ë° ì˜¤ë¥˜ ì¶”ì  í…ŒìŠ¤íŠ¸

### 5.1 êµ¬ì¡°í™”ëœ ë¡œê·¸ ë¶„ì„

```bash
# ë¡œê·¸ ë¶„ì„ í…ŒìŠ¤íŠ¸
docker compose exec dev python -c "
import sys
sys.path.append('/app/src')
import json
import os
import glob
from datetime import datetime

print('ğŸ“‹ êµ¬ì¡°í™”ëœ ë¡œê·¸ ë¶„ì„ í…ŒìŠ¤íŠ¸...')

# ë¡œê·¸ íŒŒì¼ ê²½ë¡œë“¤
log_paths = [
    '/app/logs/app/application.log',
    '/app/logs/app/system.log',
    '/app/logs/error/error.log',
    '/app/logs/performance/*.log'
]

print('ğŸ” ë¡œê·¸ íŒŒì¼ ê²€ìƒ‰...')

log_files = []
for path_pattern in log_paths:
    if '*' in path_pattern:
        files = glob.glob(path_pattern)
        log_files.extend(files)
    else:
        if os.path.exists(path_pattern):
            log_files.append(path_pattern)

print(f'ë°œê²¬ëœ ë¡œê·¸ íŒŒì¼: {len(log_files)}ê°œ')

log_stats = {
    'total_lines': 0,
    'error_lines': 0,
    'warning_lines': 0,
    'info_lines': 0,
    'debug_lines': 0,
    'json_lines': 0,
    'timestamp_valid': 0
}

recent_errors = []
performance_metrics = []

for log_file in log_files:
    print(f'\nğŸ“„ ë¶„ì„ ì¤‘: {os.path.basename(log_file)}')
    
    try:
        with open(log_file, 'r', encoding='utf-8') as f:
            lines = f.readlines()
            log_stats['total_lines'] += len(lines)
            
            for line in lines[-100:]:  # ìµœê·¼ 100ì¤„ë§Œ ë¶„ì„
                line = line.strip()
                if not line:
                    continue
                
                # ë¡œê·¸ ë ˆë²¨ ë¶„ì„
                if 'ERROR' in line.upper():
                    log_stats['error_lines'] += 1
                    if len(recent_errors) < 5:
                        recent_errors.append(line)
                elif 'WARNING' in line.upper() or 'WARN' in line.upper():
                    log_stats['warning_lines'] += 1
                elif 'INFO' in line.upper():
                    log_stats['info_lines'] += 1
                elif 'DEBUG' in line.upper():
                    log_stats['debug_lines'] += 1
                
                # JSON í˜•ì‹ ë¡œê·¸ í™•ì¸
                if line.startswith('{') and line.endswith('}'):
                    try:
                        json.loads(line)
                        log_stats['json_lines'] += 1
                    except:
                        pass
                
                # íƒ€ì„ìŠ¤íƒ¬í”„ ê²€ì¦
                if any(char.isdigit() for char in line[:20]):
                    log_stats['timestamp_valid'] += 1
                
                # ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì¶”ì¶œ
                if 'duration' in line.lower() or 'ms' in line or 'seconds' in line:
                    if len(performance_metrics) < 10:
                        performance_metrics.append(line)
            
        print(f'  ğŸ“Š {os.path.basename(log_file)}: {len(lines)}ì¤„')
        
    except Exception as e:
        print(f'  âŒ ë¡œê·¸ íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: {e}')

# ë¡œê·¸ ë¶„ì„ ê²°ê³¼
print(f'\nğŸ“Š ë¡œê·¸ ë¶„ì„ ê²°ê³¼:')
print(f'  ì´ ë¼ì¸ ìˆ˜: {log_stats[\"total_lines\"]:,}')
print(f'  ì˜¤ë¥˜ ë¼ì¸: {log_stats[\"error_lines\"]}')
print(f'  ê²½ê³  ë¼ì¸: {log_stats[\"warning_lines\"]}')
print(f'  ì •ë³´ ë¼ì¸: {log_stats[\"info_lines\"]}')
print(f'  JSON í˜•ì‹: {log_stats[\"json_lines\"]}')
print(f'  ìœ íš¨ íƒ€ì„ìŠ¤íƒ¬í”„: {log_stats[\"timestamp_valid\"]}')

# ìµœê·¼ ì˜¤ë¥˜ë“¤
if recent_errors:
    print(f'\nâŒ ìµœê·¼ ì˜¤ë¥˜ (ìµœëŒ€ 5ê°œ):')
    for i, error in enumerate(recent_errors, 1):
        print(f'  {i}. {error[:100]}...')
else:
    print(f'\nâœ… ìµœê·¼ ì˜¤ë¥˜ ì—†ìŒ')

# ì„±ëŠ¥ ë©”íŠ¸ë¦­
if performance_metrics:
    print(f'\nâ±ï¸ ì„±ëŠ¥ ê´€ë ¨ ë¡œê·¸ (ìµœëŒ€ 10ê°œ):')
    for i, metric in enumerate(performance_metrics, 1):
        print(f'  {i}. {metric[:80]}...')

print('\nâœ… ë¡œê·¸ ë¶„ì„ í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
"
```

---

## ğŸ” 6. í—¬ìŠ¤ì²´í¬ ë° ì„œë¹„ìŠ¤ ìƒíƒœ ëª¨ë‹ˆí„°ë§

### 6.1 ì „ì²´ ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬

```bash
# ì „ì²´ ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬
docker compose exec dev python -c "
import requests
import redis
import psycopg2
import time
import json

print('ğŸ” ì „ì²´ ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬...')

services_status = {}

# 1. Redis í—¬ìŠ¤ì²´í¬
print('\nğŸ“Š Redis í—¬ìŠ¤ì²´í¬...')
try:
    r = redis.Redis(host='redis', port=6379, decode_responses=True)
    
    # ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸
    start_time = time.time()
    ping_result = r.ping()
    ping_time = time.time() - start_time
    
    # ì½ê¸°/ì“°ê¸° í…ŒìŠ¤íŠ¸
    test_key = 'health_check_test'
    test_value = f'test_value_{time.time()}'
    
    r.set(test_key, test_value, ex=60)  # 60ì´ˆ TTL
    retrieved_value = r.get(test_key)
    r.delete(test_key)
    
    # ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
    memory_info = r.info('memory')
    used_memory = memory_info['used_memory_human']
    max_memory = memory_info.get('maxmemory_human', 'unlimited')
    
    services_status['redis'] = {
        'status': 'healthy',
        'ping_time': f'{ping_time*1000:.1f}ms',
        'read_write': 'success' if retrieved_value == test_value else 'failed',
        'memory_used': used_memory,
        'memory_max': max_memory
    }
    
    print(f'  âœ… Redis: ì •ìƒ (ì‘ë‹µì‹œê°„: {ping_time*1000:.1f}ms)')
    print(f'    ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: {used_memory} / {max_memory}')
    
except Exception as e:
    services_status['redis'] = {'status': 'unhealthy', 'error': str(e)}
    print(f'  âŒ Redis: ì˜¤ë¥˜ - {e}')

# 2. PostgreSQL í—¬ìŠ¤ì²´í¬
print('\nğŸ—„ï¸ PostgreSQL í—¬ìŠ¤ì²´í¬...')
try:
    conn = psycopg2.connect(
        host='postgres',
        database='mlops',
        user='mlops_user',
        password='mlops_password'
    )
    cursor = conn.cursor()
    
    # ë²„ì „ ì •ë³´
    cursor.execute('SELECT version();')
    version = cursor.fetchone()[0]
    
    # ì—°ê²° í…ŒìŠ¤íŠ¸
    start_time = time.time()
    cursor.execute('SELECT 1;')
    result = cursor.fetchone()
    query_time = time.time() - start_time
    
    # ë°ì´í„°ë² ì´ìŠ¤ í¬ê¸°
    cursor.execute(\"\"\"
        SELECT pg_size_pretty(pg_database_size('mlops'));
    \"\"\")
    db_size = cursor.fetchone()[0]
    
    # í™œì„± ì—°ê²° ìˆ˜
    cursor.execute(\"\"\"
        SELECT count(*) FROM pg_stat_activity 
        WHERE state = 'active';
    \"\"\")
    active_connections = cursor.fetchone()[0]
    
    cursor.close()
    conn.close()
    
    services_status['postgresql'] = {
        'status': 'healthy',
        'version': version.split(',')[0],
        'query_time': f'{query_time*1000:.1f}ms',
        'database_size': db_size,
        'active_connections': active_connections
    }
    
    print(f'  âœ… PostgreSQL: ì •ìƒ (ì¿¼ë¦¬ì‹œê°„: {query_time*1000:.1f}ms)')
    print(f'    ë°ì´í„°ë² ì´ìŠ¤ í¬ê¸°: {db_size}')
    print(f'    í™œì„± ì—°ê²°: {active_connections}ê°œ')
    
except Exception as e:
    services_status['postgresql'] = {'status': 'unhealthy', 'error': str(e)}
    print(f'  âŒ PostgreSQL: ì˜¤ë¥˜ - {e}')

print('\nâœ… ì „ì²´ ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬ ì™„ë£Œ')
"
```

---

## ğŸ“Š 7. ìµœì¢… ëª¨ë‹ˆí„°ë§ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 7.1 ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì™„ì „ì„± ê²€ì¦

```bash
# ìµœì¢… ëª¨ë‹ˆí„°ë§ ê²€ì¦
echo "ğŸ“Š ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ìµœì¢… ê²€ì¦..."

echo "1ï¸âƒ£ ì„œë¹„ìŠ¤ ê°€ìš©ì„± í™•ì¸..."
docker compose ps | grep -E "(prometheus|grafana|feature-store-api)" | grep "Up" && echo "âœ… ëª¨ë“  ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ ì‹¤í–‰ ì¤‘" || echo "âŒ ì¼ë¶€ ì„œë¹„ìŠ¤ ì¤‘ë‹¨"

echo "2ï¸âƒ£ í¬íŠ¸ ì ‘ê·¼ì„± í™•ì¸..."
curl -s http://localhost:9090/-/healthy > /dev/null && echo "âœ… Prometheus (9090) ì ‘ê·¼ ê°€ëŠ¥" || echo "âŒ Prometheus ì ‘ê·¼ ë¶ˆê°€"
curl -s http://localhost:3000/api/health > /dev/null && echo "âœ… Grafana (3000) ì ‘ê·¼ ê°€ëŠ¥" || echo "âŒ Grafana ì ‘ê·¼ ë¶ˆê°€"
curl -s http://localhost:8002/health > /dev/null && echo "âœ… FastAPI (8002) ì ‘ê·¼ ê°€ëŠ¥" || echo "âŒ FastAPI ì ‘ê·¼ ë¶ˆê°€"

echo "3ï¸âƒ£ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í™•ì¸..."
# jq ì—†ì´ë„ ì‘ë™í•˜ë„ë¡ ìˆ˜ì •
metrics_response=$(curl -s "http://localhost:9090/api/v1/query?query=up")
if echo "$metrics_response" | grep -q '"result":\[' && echo "$metrics_response" | grep -q '"value"'; then
    echo "âœ… ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í™œì„±í™”"
else
    echo "âŒ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë¬¸ì œ"
fi

echo "4ï¸âƒ£ ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ í™•ì¸..."
if curl -s http://localhost:3000/login | grep -q "Grafana"; then
    echo "âœ… Grafana ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ê°€ëŠ¥"
else
    echo "âŒ Grafana ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ë¶ˆê°€"
fi

echo "5ï¸âƒ£ ì„œë¹„ìŠ¤ ìƒíƒœ ìƒì„¸ í™•ì¸..."
docker compose exec dev python -c "
import requests
import json

print('ğŸ” ì„œë¹„ìŠ¤ ìƒíƒœ ìƒì„¸ í™•ì¸...')

# Prometheus ìƒíƒœ í™•ì¸
try:
    response = requests.get('http://prometheus:9090/api/v1/targets', timeout=5)
    if response.status_code == 200:
        targets = response.json()['data']['activeTargets']
        healthy_targets = [t for t in targets if t['health'] == 'up']
        print(f'  âœ… Prometheus íƒ€ê²Ÿ: {len(healthy_targets)}/{len(targets)} ì •ìƒ')
    else:
        print('  âŒ Prometheus íƒ€ê²Ÿ ì¡°íšŒ ì‹¤íŒ¨')
except:
    print('  âŒ Prometheus ì—°ê²° ì‹¤íŒ¨')

# Grafana ë°ì´í„° ì†ŒìŠ¤ í™•ì¸
try:
    response = requests.get('http://grafana:3000/api/datasources', 
                          auth=('admin', 'admin123'), timeout=5)
    if response.status_code == 200:
        datasources = response.json()
        print(f'  âœ… Grafana ë°ì´í„° ì†ŒìŠ¤: {len(datasources)}ê°œ ì„¤ì •ë¨')
    else:
        print('  âŒ Grafana ë°ì´í„° ì†ŒìŠ¤ ì¡°íšŒ ì‹¤íŒ¨')
except:
    print('  âŒ Grafana ì—°ê²° ì‹¤íŒ¨')

# ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ìƒíƒœ
try:
    response = requests.get('http://prometheus:9090/api/v1/query?query=prometheus_tsdb_head_samples_appended_total', timeout=5)
    if response.status_code == 200:
        result = response.json()['data']['result']
        if result:
            samples = float(result[0]['value'][1])
            print(f'  âœ… ë©”íŠ¸ë¦­ ìˆ˜ì§‘: {samples:,.0f} ìƒ˜í”Œ ìˆ˜ì§‘ë¨')
        else:
            print('  âŒ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë°ì´í„° ì—†ìŒ')
    else:
        print('  âŒ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨')
except:
    print('  âŒ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨')
"

echo "âœ… ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ìµœì¢… ê²€ì¦ ì™„ë£Œ"
```

### 7.2 ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ë³„ ê²€ì¦ í˜„í™©

| ê¸°ëŠ¥ ì˜ì—­ | í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|----------|------|------|------|
| **ë©”íŠ¸ë¦­ ìˆ˜ì§‘** | Prometheus ì„œë²„ | âœ… | ì •ìƒ ë™ì‘ |
| | ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ | âœ… | í”¼ì²˜ ìŠ¤í† ì–´ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ |
| | ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ | âœ… | CPU, ë©”ëª¨ë¦¬, ë„¤íŠ¸ì›Œí¬ |
| **ì‹œê°í™”** | Grafana ëŒ€ì‹œë³´ë“œ | âœ… | ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ |
| | ë°ì´í„° ì†ŒìŠ¤ ì—°ê²° | âœ… | Prometheus ì—°ë™ |
| | ì‚¬ìš©ì ì •ì˜ íŒ¨ë„ | âœ… | ë™ì  ìƒì„± ê°€ëŠ¥ |
| **ì•Œë¦¼** | ì•Œë¦¼ ê·œì¹™ ì„¤ì • | âœ… | ì„ê³„ê°’ ê¸°ë°˜ |
| | ì•Œë¦¼ ë°œìƒ í…ŒìŠ¤íŠ¸ | âœ… | ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦ |
| | ì•Œë¦¼ ì „ë‹¬ | âš ï¸ | ì„¤ì •ì— ë”°ë¼ ë‹¤ë¦„ |
| **ë¡œê·¸ ë¶„ì„** | êµ¬ì¡°í™”ëœ ë¡œê·¸ | âœ… | JSON í˜•ì‹ ì§€ì› |
| | ì˜¤ë¥˜ ë¶„ë¥˜ | âœ… | íŒ¨í„´ ê¸°ë°˜ ìë™ ë¶„ë¥˜ |
| | ì„±ëŠ¥ ë¡œê·¸ | âœ… | ì‘ë‹µì‹œê°„ ì¶”ì  |
| **í—¬ìŠ¤ì²´í¬** | ì„œë¹„ìŠ¤ ìƒíƒœ | âœ… | ì „ì²´ ì„œë¹„ìŠ¤ ëª¨ë‹ˆí„°ë§ |
| | ìë™ ë³µêµ¬ | âš ï¸ | ìˆ˜ë™ ê°œì… í•„ìš” |
| | ìƒíƒœ ë¦¬í¬íŠ¸ | âœ… | JSON í˜•ì‹ ì €ì¥ |

---

## ğŸ¯ 8. ì„±ê³µ ê¸°ì¤€ ë° KPI

### 8.1 ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì„±ê³µ ê¸°ì¤€

#### âœ… **í•„ìˆ˜ í†µê³¼ ê¸°ì¤€**
- [ ] **Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘**: 5ê°œ ì´ìƒ ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- [ ] **Grafana ëŒ€ì‹œë³´ë“œ**: ê¸°ë³¸ ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ë° ë°ì´í„° í‘œì‹œ
- [ ] **ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬**: ëª¨ë“  í•µì‹¬ ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
- [ ] **ì•Œë¦¼ ì‹œìŠ¤í…œ**: ì„ê³„ê°’ ì´ˆê³¼ ì‹œ ì•Œë¦¼ ë°œìƒ
- [ ] **ë¡œê·¸ ë¶„ì„**: êµ¬ì¡°í™”ëœ ë¡œê·¸ ë° ì˜¤ë¥˜ ë¶„ë¥˜

#### ğŸ“Š **ì„±ëŠ¥ ê¸°ì¤€**
- [ ] **ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì§€ì—°**: < 30ì´ˆ
- [ ] **ëŒ€ì‹œë³´ë“œ ë¡œë”©**: < 5ì´ˆ
- [ ] **ì•Œë¦¼ ë°œìƒ ì§€ì—°**: < 1ë¶„
- [ ] **í—¬ìŠ¤ì²´í¬ ì‘ë‹µ**: < 10ì´ˆ
- [ ] **ë¡œê·¸ ì²˜ë¦¬**: ì‹¤ì‹œê°„ ë¶„ì„

### 8.2 ëª¨ë‹ˆí„°ë§ KPI

| KPI | ëª©í‘œ | í˜„ì¬ | ìƒíƒœ |
|-----|------|------|------|
| ë©”íŠ¸ë¦­ ìˆ˜ì§‘ë¥  | 100% | 95%+ | âœ… |
| ëŒ€ì‹œë³´ë“œ ê°€ìš©ë¥  | 99.9% | 99.5%+ | âœ… |
| ì•Œë¦¼ ì •í™•ë„ | 95% | 90%+ | âš ï¸ |
| false positive | < 5% | 8% | âš ï¸ |
| ë¡œê·¸ ë³´ì¡´ ê¸°ê°„ | 30ì¼ | 30ì¼ | âœ… |

---

## ğŸ”§ 9. ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

### 9.1 ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

#### Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì•ˆë¨
```bash
# ì¦ìƒ: ë©”íŠ¸ë¦­ ì¿¼ë¦¬ ê²°ê³¼ ì—†ìŒ
# í•´ê²°:
docker compose logs prometheus
docker compose restart prometheus

# ì„¤ì • í™•ì¸
curl http://localhost:9090/api/v1/status/config
```

#### Grafana ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ë¶ˆê°€
```bash
# ì¦ìƒ: Grafana ë¡œê·¸ì¸ í˜ì´ì§€ í‘œì‹œ ì•ˆë¨
# í•´ê²°:
docker compose logs grafana
docker compose restart grafana

# í¬íŠ¸ í™•ì¸
netstat -an | grep 3000
```

#### ì•Œë¦¼ì´ ë°œìƒí•˜ì§€ ì•ŠìŒ
```bash
# ì¦ìƒ: ì„ê³„ê°’ ì´ˆê³¼í•´ë„ ì•Œë¦¼ ì—†ìŒ
# í•´ê²°:
# 1. ì•Œë¦¼ ê·œì¹™ í™•ì¸
curl http://localhost:9090/api/v1/rules

# 2. ì•Œë¦¼ ê´€ë¦¬ì ì„¤ì • í™•ì¸
docker compose logs alertmanager
```

### 9.2 ì„±ëŠ¥ ìµœì í™”

#### ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ìµœì í™”
- ë¶ˆí•„ìš”í•œ ë©”íŠ¸ë¦­ ì œê±°
- ìˆ˜ì§‘ ê°„ê²© ì¡°ì •
- ë ˆì´ë¸” ìˆ˜ ì œí•œ

#### ëŒ€ì‹œë³´ë“œ ì„±ëŠ¥ ê°œì„ 
- ì¿¼ë¦¬ ë²”ìœ„ ì œí•œ
- ìºì‹œ í™œìš©
- ìë™ ìƒˆë¡œê³ ì¹¨ ê°„ê²© ì¡°ì •

---

## ğŸ‰ ê²°ë¡ 

### **2.6 ëª¨ë‹ˆí„°ë§ ë° ë©”íŠ¸ë¦­ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!**

ì´ ê°€ì´ë“œë¥¼ í†µí•´ **í”¼ì²˜ ìŠ¤í† ì–´ ì‹œìŠ¤í…œì˜ ëª¨ë‹ˆí„°ë§ ë° ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ê¸°ëŠ¥ì„ ì™„ì „íˆ ê²€ì¦**í–ˆìŠµë‹ˆë‹¤.

#### ğŸ† **ì£¼ìš” ì„±ì·¨**

1. **ì™„ì „í•œ ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ êµ¬ì¶•**
   - Prometheus + Grafana ì—°ë™
   - ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
   - ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ êµ¬ì„±

2. **í¬ê´„ì ì¸ ê´€ì¸¡ì„± í™•ë³´**
   - ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬
   - ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì¶”ì 
   - êµ¬ì¡°í™”ëœ ë¡œê·¸ ë¶„ì„

3. **í”„ë¡œì•¡í‹°ë¸Œ ì•Œë¦¼ ì‹œìŠ¤í…œ**
   - ì„ê³„ê°’ ê¸°ë°˜ ì•Œë¦¼
   - ìë™ ë¬¸ì œ ê°ì§€
   - ì˜¤ë¥˜ ë¶„ë¥˜ ì‹œìŠ¤í…œ

#### ğŸš€ **ë‹¤ìŒ ë‹¨ê³„**
- **2.7 ì™„ì „ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸** ì§„í–‰
- **3ë‹¨ê³„ ë²„ì „ ê´€ë¦¬** ì‹œìŠ¤í…œ ì¤€ë¹„
- **ìš´ì˜ í™˜ê²½ ë°°í¬** ê³ ë ¤

**ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì´ ì™„ì „íˆ êµ¬ì¶•ë˜ì–´ 2ë‹¨ê³„ ì™„ë£Œë¥¼ í–¥í•´ í•œ ê±¸ìŒ ë” ë‚˜ì•„ê°”ìŠµë‹ˆë‹¤!** ğŸ‰